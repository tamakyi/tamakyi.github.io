<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Lskypro on 狼的公告板 ver.Hugo</title><link>https://blog.tama.guru/tags/lskypro.html</link><description>Recent content in Lskypro on 狼的公告板 ver.Hugo</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>tamakyi</copyright><lastBuildDate>Tue, 09 Sep 2025 10:18:49 +0000</lastBuildDate><atom:link href="https://blog.tama.guru/tags/lskypro/index.xml" rel="self" type="application/rss+xml"/><item><title>在兰空图床配置并使用Cloudflare R2 存储桶</title><link>https://blog.tama.guru/record/r2_on_lskypro.html</link><pubDate>Mon, 08 Jan 2024 16:00:00 +0800</pubDate><guid>https://blog.tama.guru/record/r2_on_lskypro.html</guid><description>&lt;h3 id="什么是r2为什么用r2">什么是R2，为什么用R2
&lt;/h3>&lt;p>R2是由Cloudflare推出的对象存储，接口兼容AWS S3且有免费套餐，套餐内容如下：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">类别&lt;/th>
&lt;th style="text-align: center">永远免费&lt;/th>
&lt;th style="text-align: center">按月收费&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">存储&lt;/td>
&lt;td style="text-align: center">10GB/月&lt;/td>
&lt;td style="text-align: center">0.015 美元/GB 存储&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">A类操作:状态改变&lt;/td>
&lt;td style="text-align: center">100 万次/月&lt;/td>
&lt;td style="text-align: center">4.50 美元/百万次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">B类操作:读取状态&lt;/td>
&lt;td style="text-align: center">1000 万次/月&lt;/td>
&lt;td style="text-align: center">0.36 美元/百万次&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>根据文档，各类操作包括：&lt;/p>
&lt;center>A类操作&lt;/center>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">操作名称&lt;/th>
&lt;th style="text-align: center">操作含义&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">ListBuckets&lt;/td>
&lt;td style="text-align: center">列出的存储桶及其所有者&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">PutBucket&lt;/td>
&lt;td style="text-align: center">创建存储桶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">ListObjects&lt;/td>
&lt;td style="text-align: center">返回存储桶中的对象&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">PutObject&lt;/td>
&lt;td style="text-align: center">创建对象&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">CopyObject&lt;/td>
&lt;td style="text-align: center">复制对象&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">CompleteMultipartUpload&lt;/td>
&lt;td style="text-align: center">完成分片上传&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">CreateMultipartUpload&lt;/td>
&lt;td style="text-align: center">创建分片上传任务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">ListMultipartUploads&lt;/td>
&lt;td style="text-align: center">列出分片上传（进度）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">UploadPart&lt;/td>
&lt;td style="text-align: center">分片上传&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">UploadPartCopy&lt;/td>
&lt;td style="text-align: center">从一个已存在的Object中拷贝数据来上传一个分片&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">ListParts&lt;/td>
&lt;td style="text-align: center">列出分片&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">PutBucketEncryption&lt;/td>
&lt;td style="text-align: center">存储桶加密&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">PutBucketCors&lt;/td>
&lt;td style="text-align: center">为指定的存储桶设置跨域资源共享CORS规则&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">PutBucketLifecycleConfiguration&lt;/td>
&lt;td style="text-align: center">设置对象生命周期规则&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;center>B类操作&lt;/center>
| 操作名称 | 操作含义 |
|:-------------------------------:|:--------------------------------------------:|
| HeadBucket | 确定是否存在存储桶以及是否有访问权限 |
| HeadObject | 确定是否存在对象以及是否有访问权限 |
| GetObject | 获取（下载）对象 |
| UsageSummary | 使用情况摘要 |
| GetBucketEncryption | 获取（下载）加密存储桶 |
| GetBucketLocation | 获取（下载）加存储桶位置 |
| GetBucketCors | 获取存储桶设置跨域资源共享CORS规则 |
| GetBucketLifecycleConfiguration | 获取对象生命周期规则 |
&lt;center>免费操作&lt;/center>
| 操作名称 | 操作含义 |
|:-------------------------------:|:--------------------------------------------:|
| DeleteObject | 删除对象 |
| DeleteBucket | 删除桶 |
| DeleteMultipartUpload | 中止分片上传 |
也就是说R2只对存储和状态修改产生费用，下载不计费，对于小网站来说足够了。
注意:看一下这篇文章[https://machbbs.com/hostloc/640526][1]，避免被坑美刀。
&lt;h3 id="有什么不足">有什么不足
&lt;/h3>&lt;p>Cloudflare祝您新的一年红红火火。&lt;/p>
&lt;h3 id="如何接入">如何接入
&lt;/h3>&lt;h4 id="cloudflare网页端配置">Cloudflare网页端配置
&lt;/h4>&lt;p>配置之前需要把一个域名接入Cloudflare并设置好解析。比如我的域名&lt;code>i-tama.website&lt;/code>分配一个二级域名&lt;code>r2.i-tama.website&lt;/code>用于自定义访问域名，解析内容任意即可，因为后面接入的时候会自动修改成CNAME接入。&lt;/p>
&lt;p>首先进入Cloudflare仪表盘的R2，点击创建存储桶：&lt;/p>
&lt;p>&lt;code>存储桶名称&lt;/code>：填写3-63个不含特殊字符，比如我使用的&lt;code>tamabox&lt;/code>。&lt;/p>
&lt;p>位置：选择自动，提供位置提示默认是无的情况下会根据位置自动选择，如果是针对中国的网站那最好是修改为亚太地区(APAC)。（注：记住这个APAC，后面会用到）&lt;/p>
&lt;p>然后点击创建，创建完成之后进入设置，设置界面有几个需要注意的地方：&lt;/p>
&lt;p>名称和S3 API：这两个后面连接需要用得到，可以保存下来。&lt;/p>
&lt;p>自定义域：这里就是配置自定义域名的位置，点击&lt;code>连接域&lt;/code>，填写需要自定义访问的域名（不加https），例如&lt;code>r2.i-tama.website&lt;/code>，并继续，然后会提示现有DNS记录将变更成CNAME解析，点击连接域之后等待初始化完成，约1-2分钟即可。成功后该域的状态应为&lt;code>有效&lt;/code>，且访问存储桶为&lt;code>已允许&lt;/code>。&lt;/p>
&lt;p>R2.dev子域：这里配置允许会生成一个&lt;code>r2.dev&lt;/code>结尾的二级域名用于公共访问，使用这个方式访问可能会有速度限制，但我没尝试过。配置也很简单，点击允许之后输入&lt;code>allow&lt;/code>即可。&lt;/p>
&lt;p>CORS策略：实际使用时可能会碰到跨域错误在这里配置即可，此处不做修改。&lt;/p>
&lt;p>以上配置完成后回退到R2仪表盘，进入账户详细信息下的管理R2 API令牌并选择创建API令牌：&lt;/p>
&lt;p>令牌名称：任意填写 记得就行。&lt;/p>
&lt;p>权限：因为我们是用来做图床的，涉及到文件读写，建议直接配置成管理员读和写。&lt;/p>
&lt;p>指定存储桶：建议一个桶一个API，所以我选择仅应用于特定存储桶，并选择刚才创建的桶。&lt;/p>
&lt;p>TTL:永久。&lt;/p>
&lt;p>客户端IP地址筛选：留空即可。&lt;/p>
&lt;p>最后创建API令牌，此时会得到令牌值、访问秘钥ID和机密访问密钥三个值，需要妥善保存好，因为确认之后就不会再出现这些数据了。&lt;/p>
&lt;p>至此，Cloudflare网页端配置完成。&lt;/p>
&lt;h4 id="图床端配置">图床端配置
&lt;/h4>&lt;p>登录管理员账号进入系统设置 &amp;gt; 存储策略，选择新建一个存储策略。&lt;/p>
&lt;p>角色组根据自己的选择去配置即可。&lt;/p>
&lt;p>名称和简介自行设置好即可。&lt;/p>
&lt;p>存储策略选择AWS S3。&lt;/p>
&lt;p>访问域名填写在Cloudflare设置的自定义域，比如我的是&lt;code>https://r2.i-tama.website/tamabox&lt;/code>。&lt;/p>
&lt;p>&lt;strong>注意，这里的格式是自定义域名+桶名称，如果只填写域名，后面上传的时候会发现我们上传的图片a.png会被上传到&lt;code>https://r2.i-tama.website/tamabox/%year%/%month%/%day%/a.png&lt;/code>，但图床中显示的链接是&lt;code>https://r2.i-tama.website/%year%/%month%/%day%/a.png&lt;/code>，结果就是404了。&lt;/strong>&lt;/p>
&lt;p>AccessKeyId和SecretAccessKey即前面提到的访问秘钥ID以及机密访问秘钥。&lt;/p>
&lt;p>连接地址填写S3 API。&lt;/p>
&lt;p>区域就是前面我们配置位置信息的简码，如果我们选择亚太这里就是填apac。&lt;/p>
&lt;p>储存桶名称即桶名称。&lt;/p>
&lt;p>是否使用路径样式&lt;strong>不要勾选&lt;/strong>，因为勾选之后上传到R2会再多一层路径。比如原来上传的位置是&lt;code>https://r2.i-tama.website/tamabox/%year%/%month%/%day%/a.png&lt;/code>，勾选之后就变成&lt;code>https://r2.i-tama.website/tamabox/tamabox/%year%/%month%/%day%/a.png&lt;/code>了。&lt;/p>
&lt;p>是否在文件上设置公开ACL，这里打开，保存之后随意上传个文件测试是否能上传成功，一般按这个步骤是不会有问题的。&lt;/p>
&lt;h3 id="体验如何">体验如何
&lt;/h3>&lt;p>我没开代理的情况下上传大概是200-300kb/s，下载差不多也是这个速度，只能说基本够用。&lt;/p></description></item><item><title>使用lskypro作为typecho图床</title><link>https://blog.tama.guru/record/lskypro.html</link><pubDate>Mon, 11 Jul 2022 20:46:00 +0800</pubDate><guid>https://blog.tama.guru/record/lskypro.html</guid><description>&lt;p>如果你的服务器在国外导致部分内容加载缓慢，同时因为CDN需要准备七七八八的(cloudflare除外，但是体验一样不好)，又信不过国内一众免费图床（稳定性和安全性问题），那么可以试着使用lskypro在国内服务器自建图床。&lt;/p>
&lt;p>官网地址：&lt;a class="link" href="https://docs.lsky.pro/docs/v2/#%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener"
>Lsky Pro V 2.x | Lsky Pro&lt;/a>&lt;/p>
&lt;p>依赖：（推荐使用宝塔面板安装依赖插件，以下操作均在宝塔面板操作并通过测试）&lt;/p>
&lt;ul>
&lt;li>PHP &amp;gt;= 8.0.2&lt;/li>
&lt;li>BCMath PHP 扩展&lt;/li>
&lt;li>Ctype PHP 扩展&lt;/li>
&lt;li>DOM PHP 拓展&lt;/li>
&lt;li>Fileinfo PHP 扩展&lt;/li>
&lt;li>JSON PHP 扩展&lt;/li>
&lt;li>Mbstring PHP 扩展&lt;/li>
&lt;li>OpenSSL PHP 扩展&lt;/li>
&lt;li>PDO PHP 扩展&lt;/li>
&lt;li>Tokenizer PHP 扩展&lt;/li>
&lt;li>XML PHP 扩展&lt;/li>
&lt;li>Imagick 拓展&lt;/li>
&lt;li>exec、shell_exec 函数&lt;/li>
&lt;li>readlink、symlink 函数&lt;/li>
&lt;li>putenv、getenv 函数&lt;/li>
&lt;li>关闭&lt;code>open_basedir&lt;/code>(即“防跨站”，在宝塔的网站-设置-网站目录-防跨站攻击(open_basedir))&lt;/li>
&lt;/ul>
&lt;p>数据库版本要求：&lt;/p>
&lt;ul>
&lt;li>Mysql 5.7+&lt;/li>
&lt;li>PostgreSQL 9.6+&lt;/li>
&lt;li>SQLite 3.8.8+&lt;/li>
&lt;li>SQL Server 2017+&lt;/li>
&lt;/ul>
&lt;p>软件下载地址：&lt;a class="link" href="https://github.com/lsky-org/lsky-pro/releases" target="_blank" rel="noopener"
>https://github.com/lsky-org/lsky-pro/releases&lt;/a>&lt;/p>
&lt;p>部署到服务器上之后，设置好伪静态：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> try_files $uri $uri/ /index.php?$query_string;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行目录选择&lt;code>/public&lt;/code>。&lt;/p>
&lt;p>可能因为权限问题导致目录访问不了等问题，因此要在lskypro的目录运行：&lt;/p>
&lt;p>&lt;code>chown -R www:www *&lt;/code>&lt;/p>
&lt;p>&lt;code>chmod -R 755 *&lt;/code>&lt;/p>
&lt;p>之后访问安装的地址即可进入检测界面，这里可能会提示&lt;code>chown&lt;/code>、&lt;code>chmod&lt;/code>等功能不可用，可以在宝塔的PHP设置中把以上的禁用函数取消掉。&lt;/p>
&lt;p>如无问题，即可进入账户设置和服务器链接的界面。&lt;/p>
&lt;hr>
&lt;p>安装完成后默认是所有人都能上传的，这可能会导致一些问题，因此最好是设置一个管理员群组：&lt;/p>
&lt;img src="https://pic.tama.guru/i/2022/07/11/62cc175c060a8.png" alt="请输入图片描述" loading="lazy" style="max-width: 100%; height: auto;">
&lt;p>在设置中关闭游客上传和注册功能：&lt;/p>
&lt;img src="https://pic.tama.guru/i/2022/07/11/62cc17b76b256.png" alt="请输入图片描述" loading="lazy" style="max-width: 100%; height: auto;">
&lt;p>接口打开留着以便后面使用。&lt;/p>
&lt;hr>
&lt;p>接入typecho：&lt;/p>
&lt;p>&lt;a class="link" href="https://www.coldyun.cn/archives/140.html" target="_blank" rel="noopener"
>typecho兰空（LskyPro）图床插件 - Cold' Blog (coldyun.cn)&lt;/a>在莫言的1.0版本插件基础上新增了对lskypro2.0版本的支持，直接到他的博客下载附件上传到typecho下的plugin安装即可。插件需要填写&lt;code>Api&lt;/code>和&lt;code>Token&lt;/code>两项，其中&lt;code>Token&lt;/code>与上面的接口有关，我们需要通过post的方式获得&lt;code>token&lt;/code>：此处使用&lt;a class="link" href="https://www.postman.com/" target="_blank" rel="noopener"
>Postman&lt;/a>：&lt;/p>
&lt;p>注册成功后在左侧的collections点击加号，在New Collection点击&lt;code>GET New Request&lt;/code>&lt;img src="https://pic.tama.guru/i/2022/07/11/62cc19d910ed0.png" alt="请输入图片描述" loading="lazy" style="max-width: 100%; height: auto;">&lt;/p>
&lt;p>接下来在右侧把GET切换成POST：&lt;/p>
&lt;img src="https://pic.tama.guru/i/2022/07/11/62cc1a8d574f8.png" alt="请输入图片描述" loading="lazy" style="max-width: 100%; height: auto;">
&lt;p>其中链接填写&lt;code>https://hostname/api/v1/tokens&lt;/code> hostname是你的lskypro服务安装域名。&lt;/p>
&lt;p>key填写&lt;code>email&lt;/code>和&lt;code>password&lt;/code>后面的value为lskypro安装注册时填写的管理员邮箱和密码，之后点击Send，下方会提示：&lt;img src="https://pic.tama.guru/i/2022/07/11/62cc1b5f8d671.png" alt="请输入图片描述" loading="lazy" style="max-width: 100%; height: auto;">&lt;/p>
&lt;p>此处即我们需要的token，填写进插件即可，后面就能正常使用了。&lt;/p>
&lt;p>&lt;code>[scode type=&amp;quot;yellow&amp;quot;]注意！如果提示500错误，极有可能是跨域设置问题，对于宝塔面板需要关掉防跨站攻击，对于lnmp需要进入&lt;/code>lnmp/tools&lt;code>目录执行&lt;/code>remove_open_basedir_restriction.sh&lt;code>，并输入图床源代码所在的目录，保存并执行&lt;/code>lnmp restart即可&lt;code>[/scode]&lt;/code>&lt;/p></description></item></channel></rss>