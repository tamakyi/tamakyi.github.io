<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Xrdp on 狼的公告板 ver.Hugo</title><link>https://blog.tama.guru/tags/xrdp.html</link><description>Recent content in Xrdp on 狼的公告板 ver.Hugo</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>tamakyi</copyright><lastBuildDate>Tue, 26 Aug 2025 03:42:27 +0000</lastBuildDate><atom:link href="https://blog.tama.guru/tags/xrdp/index.xml" rel="self" type="application/rss+xml"/><item><title>在archlinux正确的使用xrdp以及碰到的问题</title><link>https://blog.tama.guru/record/archlinux_xrdp.html</link><pubDate>Mon, 05 Feb 2024 23:58:41 +0800</pubDate><guid>https://blog.tama.guru/record/archlinux_xrdp.html</guid><description>&lt;p>为什么不用vnc？一是需要另外装个软件，不方便，而且配置麻烦，总是能碰到七七八八的问题，而用xrdp基本上用巨硬自带的软件就能实现远程连接。&lt;/p>
&lt;h4 id="安装并配置xrdp">安装并配置xrdp
&lt;/h4>&lt;p>&lt;strong>注：我是kde桌面环境&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo pacman -S xorg-xinit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S base-devel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yay -S xrdp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以上是基础软件包，下面根据平台选择安装：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">yay -S xortxrdp-glamor &lt;span class="c1">#适用于I家和A家核显解码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yay -S xorgxrdp &lt;span class="c1">#使用CPU编码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yay -S xordxrdp-nvidia &lt;span class="c1">#使用英伟达独显解码&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改&lt;code>/etc/X11/Xwrapper.config&lt;/code>（无此文件自行新建），添加如下内容：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">allowed_users&lt;/span>&lt;span class="o">=&lt;/span>anybody
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">needs_root_rights&lt;/span>&lt;span class="o">=&lt;/span>no
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>复制一个.xinitrc到用户主目录并编辑其中内容:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">cp /etc/X11/xinit/xinitrc /home/&lt;span class="nv">$USERNAME&lt;/span>/.xinitrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注释掉最后的几行&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#twm &amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#xclock -geometry 50x50-1+1 &amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#xterm -geometry 80x50+494+51 &amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#xterm -geometry 80x20+494-0 &amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#exec xterm -geometry 80x66+0+0 -name login&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">DESKTOP_SESSION&lt;/span>&lt;span class="o">=&lt;/span>plasma
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/lib/plasma-dbus-run-session-if-needed startplasma-x11
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>最后两行根据桌面环境替换：
i3w / dwm:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exec&lt;/span> i3w
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>gnome&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">unset&lt;/span> SESSION_MANAGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">unset&lt;/span> DBUS_SESSION_BUS_ADDRESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exec&lt;/span> dbus-launch gnome-shell --x11
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>xfce4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">unset&lt;/span> SESSION_MANAGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">unset&lt;/span> DBUS_SESSION_BUS_ADDRESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exec&lt;/span> dbus-launch startxfce4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动xrdp服务：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> xrdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start xrdp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="一些小问题">一些小问题：
&lt;/h4>&lt;h5 id="安装以后黑屏闪退">安装以后，黑屏、闪退
&lt;/h5>&lt;ol>
&lt;li>可以尝试修改&lt;code>/etc/xrdp/xrdp.ini&lt;/code>，把&lt;code>allow_channels=true&lt;/code>改成&lt;code>allow_channels=false&lt;/code>&lt;/li>
&lt;li>使用&lt;code>ps -elf|grep vnc&lt;/code>查询是否有多个进程同时运行，如果有，直接&lt;code>kill -9 $pid&lt;/code>（为避免出现这种问题建议每次都注销而不是直接叉掉rdp窗口）&lt;/li>
&lt;/ol>
&lt;h5 id="权限输入密码弹窗不出来">权限（输入密码）弹窗不出来
&lt;/h5>&lt;p>新增&lt;code>/etc/polkit-1/rules.d/49-nopasswd_global.rules&lt;/code>文件，并添加以下内容：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">/* Allow members of the wheel group to execute any actions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * without password authentication, similar to &lt;span class="s2">&amp;#34;sudo NOPASSWD:&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> */
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">polkit.addRule&lt;span class="o">(&lt;/span>&lt;span class="k">function&lt;/span>&lt;span class="o">(&lt;/span>action, subject&lt;span class="o">)&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">((&lt;/span> action.id &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;org.freedesktop.policykit.exec&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">||&lt;/span> action.id &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;org.fedoraproject.FirewallD1.all&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">||&lt;/span> action.id &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;org.fedoraproject.FirewallD1.config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">||&lt;/span> action.id &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;org.freedesktop.NetworkManager.settings.modify.system&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> subject.isInGroup&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;wheel&amp;#34;&lt;/span>&lt;span class="o">))&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> polkit.Result.YES&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">})&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改后会默认允许所有授权，可能存在一定风险。&lt;/p>
&lt;h5 id="修改3389端口">修改3389端口
&lt;/h5>&lt;p>修改配置文件&lt;code>/etc/xrdp/xrdp.ini&lt;/code>中&lt;code>port=3389&lt;/code>字段即可，如果有开防火墙记得开放端口。&lt;/p></description></item></channel></rss>