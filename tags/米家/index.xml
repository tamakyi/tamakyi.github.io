<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>米家 on 狼的公告板 ver.Hugo</title><link>https://blog.tama.guru/tags/%E7%B1%B3%E5%AE%B6.html</link><description>Recent content in 米家 on 狼的公告板 ver.Hugo</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>tamakyi</copyright><lastBuildDate>Sun, 24 Aug 2025 02:01:31 +0000</lastBuildDate><atom:link href="https://blog.tama.guru/tags/%E7%B1%B3%E5%AE%B6/index.xml" rel="self" type="application/rss+xml"/><item><title>Debian12下通过docker安装homeassistant-hacs</title><link>https://blog.tama.guru/record/homeassistant-hacs-debian12.html</link><pubDate>Fri, 25 Aug 2023 11:58:39 +0800</pubDate><guid>https://blog.tama.guru/record/homeassistant-hacs-debian12.html</guid><description>&lt;p>HACS即&lt;code>Home Assistant Community Store&lt;/code>，整合了很多homeassistant的第三方集成，比如说米家的相关设备，如果使用官方自带的集成，一般只能识别出几个传感器，而且无法控制，如果想要把米家的设备完全接入就需要安装HACS下面的Xiaomi Miot Auto这个集成，安装之后效果如图所示，基本上能实现HASS管理全部米家设备的想法。
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://r2.337845818.best/oss-to-r2/2023/08/25/64e820b842fb5.png">
&lt;img src="https://r2.337845818.best/oss-to-r2/2023/08/25/64e820b842fb5.png" alt="安装集成之后的页面" />
&lt;/a>
&lt;/div>
&lt;img src="https://r2.337845818.best/oss-to-r2/2023/08/25/64e820b842fb5.png"
loading="lazy"
alt="安装集成之后的页面"
>
安装HACS难的地方在于需要homeassistant supervised版本，要么在物理机上安装hassos，要么弄个虚拟机给hass，还有一种方法是在debian系的系统上通过docker实现，因为前面两种方法影响太大，我选择第三个。
需要注意的是最好使用原版debian系统，我现在用的是debian 12.1，正好适合。&lt;/p>
&lt;hr>
&lt;p>####首先肯定是先安装docker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">apt&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">wget&lt;/span> &lt;span class="n">gnupg&lt;/span> &lt;span class="n">dpkg&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">https&lt;/span> &lt;span class="n">lsb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">release&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificates&lt;/span> &lt;span class="c1">#安装必要组件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">curl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">sS&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">debian&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gpg&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">gpg&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">dearmor&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">keyrings&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gpg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-ce.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian $(lsb_release -sc) stable&amp;#34;&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sources&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="c1">#添加源和证书&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>####安装OS-AGENT和supervised&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">assistant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent_1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span>&lt;span class="n">_linux_x86_64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">deb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dpkg&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent_1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span>&lt;span class="n">_linux_x86_64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">deb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">assistant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">supervised&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">installer&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">homeassistant&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">supervised&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">deb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dpkg&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">homeassistant&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">supervised&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">deb&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装supervised包时可能会报错，需要安装以下依赖包：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apt install libmicrohttpd12 systemd-journal-remote systemd-resolved libnss-resolve jq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>supervised包安装好后要重启一次机器，不然有可能会遇到解析&lt;code>checkonline.home-assistant.io&lt;/code>错误的情况。
重启之后在终端里执行&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker ps
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看到出现了很多进程。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">~ sudo docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">80d950683f05 ghcr.io/home-assistant/amd64-hassio-multicast:2023.06.2 &amp;#34;/init&amp;#34; 3 hours ago Up 3 hours hassio_multicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">e2c45b161283 ghcr.io/home-assistant/amd64-hassio-audio:2023.06.0 &amp;#34;/init&amp;#34; 3 hours ago Up 3 hours hassio_audio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">61df701e5ca7 ghcr.io/home-assistant/amd64-hassio-dns:2023.06.2 &amp;#34;/init&amp;#34; 3 hours ago Up 3 hours hassio_dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">a6d8e3385086 ghcr.io/home-assistant/amd64-hassio-cli:2023.06.0 &amp;#34;/init&amp;#34; 3 hours ago Up 3 hours hassio_cli
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9c80287b1474 ghcr.io/home-assistant/qemux86-64-homeassistant:2023.8.4 &amp;#34;/init&amp;#34; 3 hours ago Up 36 minutes homeassistant
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">7f3cb9ef899e ghcr.io/home-assistant/amd64-hassio-observer:2023.06.0 &amp;#34;/usr/bin/observer&amp;#34; 3 hours ago Up 3 hours 0.0.0.0:4357-&amp;gt;80/tcp, :::4357-&amp;gt;80/tcp hassio_observer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1e946ecbdc4d ghcr.io/home-assistant/amd64-hassio-supervisor:latest &amp;#34;/init&amp;#34; 3 hours ago Up 3 hours hassio_supervisor
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这个过程可能需要几分钟，如果可行的话建议还要挂上梯子。几分钟后浏览器访问&lt;code>http://IP:8123&lt;/code>可以到达hass界面，如果访问不了的建议检查防火墙是否放行8123端口。
####安装HACS并配置Xiaomi Miot Auto
安装HACS只需要在终端里执行&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget -O - https://get.hacs.xyz | bash -
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>会自动安装到hass的第三方目录下，安装完成后重启HASS。
然后在HACS下的集成选择浏览并下载存储库，在其中找到Xiaomi Miot Auto，选择安装。
安装完成之后在配置-设备与服务-添加集成-选择Xiaomi Miot Auto，然后输入小米账号ID 密码 服务器选择CN，保存之后所有设备就都出来。&lt;/p></description></item></channel></rss>