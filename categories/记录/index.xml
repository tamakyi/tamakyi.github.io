<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>记录 on 狼的公告板 ver.Hugo</title><link>https://blog.tama.guru/categories/%E8%AE%B0%E5%BD%95.html</link><description>Recent content in 记录 on 狼的公告板 ver.Hugo</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>tamakyi</copyright><lastBuildDate>Fri, 27 Feb 2026 16:56:35 +0800</lastBuildDate><atom:link href="https://blog.tama.guru/categories/%E8%AE%B0%E5%BD%95/index.xml" rel="self" type="application/rss+xml"/><item><title>自托管密码柜 - 自建vaultwarden密码管理服务</title><link>https://blog.tama.guru/record/vaultwarden-selfhost.html</link><pubDate>Fri, 27 Feb 2026 16:55:00 +0800</pubDate><guid>https://blog.tama.guru/record/vaultwarden-selfhost.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 自托管密码柜 - 自建vaultwarden密码管理服务" />&lt;h3 id="前言">前言
&lt;/h3>&lt;p>原来我好多两步验证服务都是托管在微软的Authenticator上，一开始我以为这玩意带云同步功能，就算换手机了只要重新登入微软账号就能把两步验证也同步过去，但实践之后的惨痛的代价告诉我这样行不通（现在还有几个设置了两步验证的网站上不去，人工客服也爱理不理，感觉要凉），但看看同类的软件无非就是谷歌验证器之类那几个，以下是D老师做的对比：&lt;/p>
&lt;h4 id="同类软件对比">同类软件对比
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">软件名称&lt;/th>
&lt;th style="text-align: left">主要功能&lt;/th>
&lt;th style="text-align: left">优点&lt;/th>
&lt;th style="text-align: left">缺点&lt;/th>
&lt;th style="text-align: left">平台支持&lt;/th>
&lt;th style="text-align: left">价格模型&lt;/th>
&lt;th style="text-align: left">是否开源&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">&lt;strong>微软 Authenticator&lt;/strong>&lt;/td>
&lt;td style="text-align: left">双因素认证 (2FA)，特别集成微软账户&lt;/td>
&lt;td style="text-align: left">1. 与微软生态系统无缝集成&lt;br>2. 支持便捷的推送通知验证&lt;br>3. 提供云备份和跨设备同步&lt;/td>
&lt;td style="text-align: left">1. 功能主要围绕微软账户优化&lt;br>2. 推送验证需网络连接&lt;br>3. 备份数据存储在微软云，存在隐私顾虑&lt;/td>
&lt;td style="text-align: left">iOS, Android&lt;/td>
&lt;td style="text-align: left">免费&lt;/td>
&lt;td style="text-align: left">否&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;strong>谷歌验证器 (Google Authenticator)&lt;/strong>&lt;/td>
&lt;td style="text-align: left">基于TOTP/HOTP标准的2FA验证器&lt;/td>
&lt;td style="text-align: left">1. 轻量、简洁、启动快&lt;br>2. 完全开源，代码透明&lt;br>3. 完全离线工作，无需网络&lt;br>4. 支持账户导出/导入 (较新版本)&lt;/td>
&lt;td style="text-align: left">1. 功能单一，仅限2FA&lt;br>2. 无官方云备份，设备丢失可能导致账户锁定&lt;br>3. 用户需自行管理密钥备份&lt;/td>
&lt;td style="text-align: left">iOS, Android&lt;/td>
&lt;td style="text-align: left">免费&lt;/td>
&lt;td style="text-align: left">是&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;strong>Bitwarden&lt;/strong>&lt;/td>
&lt;td style="text-align: left">综合性密码管理器，内置2FA验证器&lt;/td>
&lt;td style="text-align: left">1. 开源且经过安全审计&lt;br>2. 集密码管理与2FA于一体，一站式安全&lt;br>3. 强大的跨平台客户端和浏览器扩展&lt;br>4. 支持自托管 (需付费订阅)&lt;/td>
&lt;td style="text-align: left">1. 使用官方服务器需信任其基础设施&lt;br>2. 高级功能 (如自托管、紧急访问) 需付费订阅&lt;br>3. 作为密码管理器，功能比纯验证器复杂&lt;/td>
&lt;td style="text-align: left">Web, Windows, macOS, Linux, iOS, Android， 主流浏览器扩展&lt;/td>
&lt;td style="text-align: left">免费版功能完整；高级功能需付费订阅&lt;/td>
&lt;td style="text-align: left">是&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">&lt;strong>Vaultwarden&lt;/strong> (原 Bitwarden_rs)&lt;/td>
&lt;td style="text-align: left">Bitwarden 密码管理服务器的自托管替代方案&lt;/td>
&lt;td style="text-align: left">1. &lt;strong>完全掌控数据&lt;/strong>，服务器私有化部署&lt;br>2. 兼容所有官方 Bitwarden 客户端，无需修改&lt;br>3. 资源占用低，对硬件要求友好&lt;br>4. 可免费使用 Bitwarden 付费版的大部分功能&lt;/td>
&lt;td style="text-align: left">1. &lt;strong>需要一定的技术能力&lt;/strong>进行部署、维护、更新和备份&lt;br>2. 安全责任由用户自己承担&lt;br>3. 非官方服务器，尽管社区活跃且受信任&lt;/td>
&lt;td style="text-align: left">任何可部署 Docker 或二进制文件的服务器；通过 Bitwarden 客户端访问&lt;/td>
&lt;td style="text-align: left">软件免费；需自行承担服务器成本&lt;/td>
&lt;td style="text-align: left">是&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>考虑到这类软件的安全敏感性，最终还是选择自己部署Vaultwarden。&lt;/p>
&lt;p>如果服务器资源充裕可以直接使用docker进行部署，而我为了节约成本选择自己编译二进制文件。&lt;/p>
&lt;h3 id="前期准备">前期准备
&lt;/h3>&lt;h4 id="docker方式">Docker方式
&lt;/h4>&lt;p>一般来说使用Docker构建是最快的，直接编辑&lt;code>docker-compose.yml&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span class="line">&lt;span class="cl">version: &lt;span class="s1">&amp;#39;3.7&amp;#39;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>services:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>vaultwarden:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>image: vaultwarden/server:latest&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>container_name: vaultwarden&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>restart: unless-stopped&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">expose&lt;/span>&lt;span class="s">:&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- &lt;span class="s2">&amp;#34;80&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>volumes:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- ./vw-data:/data&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">env&lt;/span>ironment:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- &lt;span class="nv">SIGNUPS_ALLOWED&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="c1"># 首次运行允许注册&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- &lt;span class="nv">WEBSOCKET_ENABLED&lt;/span>&lt;span class="o">=&lt;/span>true&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- &lt;span class="nv">ADMIN_TOKEN&lt;/span>&lt;span class="o">=&lt;/span>your_admin_token_here &lt;span class="c1"># 管理员界面访问令牌&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- &lt;span class="nv">DOMAIN&lt;/span>&lt;span class="o">=&lt;/span>https://your-domain.com&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>networks:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>- nginx-reverse-proxy&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>networks:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>nginx-reverse-proxy:&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>external: true&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这样就会构建一个使用SQLite+Nginx的vaultwarden环境，再配置一下反代即可：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">listen&lt;/span> &lt;span class="mi">443&lt;/span> &lt;span class="s">ssl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">server_name&lt;/span> &lt;span class="s">your-domain.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">ssl_certificate&lt;/span> &lt;span class="s">/etc/nginx/certs/fullchain.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">ssl_certificate_key&lt;/span> &lt;span class="s">/etc/nginx/certs/privkey.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://vaultwarden:80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Host&lt;/span> &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Real-IP&lt;/span> &lt;span class="nv">$remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-For&lt;/span> &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">X-Forwarded-Proto&lt;/span> &lt;span class="nv">$scheme&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">location&lt;/span> &lt;span class="s">/notifications/hub&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://vaultwarden:3012&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Upgrade&lt;/span> &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">proxy_set_header&lt;/span> &lt;span class="s">Connection&lt;/span> &lt;span class="s">&amp;#34;upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>必须要配置ssl才能访问。&lt;/p>
&lt;h4 id="二进制直接运行">二进制直接运行
&lt;/h4>&lt;p>因为我机器上已经有Postgresql+Nginx，加上docker本身会有一些开销，vaultwarden本身就是rust编译的，运行内存很小，套上docker之后优势就不存在了。&lt;/p>
&lt;p>编译的过程非常痛苦，本地机器4c8g都能被干到卡死，所以干脆用Github Action编译，如果使用postgres作为数据库的可以直接用我这个项目：&lt;a class="link" href="https://github.com/tamakyi/vaultwarden" target="_blank" rel="noopener"
>tamakyi/vaultwarden&lt;/a>。&lt;/p>
&lt;p>新建一个文件夹把内容解压其中：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">wget https://github.com/tamakyi/vaultwarden/releases/download/1.35.4/vaultwarden-1.35.4-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar zxvf vaultwarden-1.35.4-linux.tar.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>会获得二进制文件&lt;code>vaultwarden_linux&lt;/code>和文件夹&lt;code>web-vault&lt;/code>，配置文件和目录&lt;/p>
&lt;h5 id="编写初始配置文件etcvaultwardenenv">编写初始配置文件&lt;code>/etc/vaultwarden.env&lt;/code>
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DATA_FOLDER&lt;/span>&lt;span class="o">=&lt;/span>/var/lib/vaultwarden/data/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DATABASE_URL&lt;/span>&lt;span class="o">=&lt;/span>postgresql://&lt;span class="o">[&lt;/span>数据库用户名&lt;span class="o">]&lt;/span>:&lt;span class="o">[&lt;/span>数据库密码&lt;span class="o">]&lt;/span>@127.0.0.1:5432/&lt;span class="o">[&lt;/span>数据库名&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">IP_HEADER&lt;/span>&lt;span class="o">=&lt;/span>X-Real-IP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WEB_VAULT_FOLDER&lt;/span>&lt;span class="o">=&lt;/span>/var/lib/vaultwarden/web-vault/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WEB_VAULT_ENABLED&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ADMIN_TOKEN&lt;/span>&lt;span class="o">=[&lt;/span>base64码&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="o">=&lt;/span>https://vaultwarden.tama.guru
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>数据库需要提前创建，ADMIN_TOKEN可以通过执行：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">openssl rand -base64 &lt;span class="m">48&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>获取，这属于明文密码，官方不推荐，建议配置完关掉admin页面访问权限。&lt;/p>
&lt;h5 id="使用systemctl管理vaultwarden">使用systemctl管理vaultwarden
&lt;/h5>&lt;p>新建&lt;code>/etc/systemd/system/vaultwarden.service&lt;/code>并编辑内容：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>Vaultwarden Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Documentation&lt;/span>&lt;span class="o">=&lt;/span>https://github.com/tamakyi/vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target postgresql.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Requires&lt;/span>&lt;span class="o">=&lt;/span>postgresql.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">User&lt;/span>&lt;span class="o">=&lt;/span>vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Group&lt;/span>&lt;span class="o">=&lt;/span>vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">EnvironmentFile&lt;/span>&lt;span class="o">=&lt;/span>/etc/vaultwarden.env
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/usr/bin/vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LimitNOFILE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1048576&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LimitNPROC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PrivateTmp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PrivateDevices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ProtectHome&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ProtectSystem&lt;/span>&lt;span class="o">=&lt;/span>strict
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WorkingDirectory&lt;/span>&lt;span class="o">=&lt;/span>/var/lib/vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ReadWriteDirectories&lt;/span>&lt;span class="o">=&lt;/span>/var/lib/vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">AmbientCapabilities&lt;/span>&lt;span class="o">=&lt;/span>CAP_NET_BIND_SERVICE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后可以尝试启动vaultwarden了：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> vaultwarden
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start vaultwarden
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果提示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">Rocket has launched from http://127.0.0.1:8000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>则表明服务已经正常启动了。&lt;/p>
&lt;h5 id="配置cloudflare-tunnle访问">配置cloudflare tunnle访问
&lt;/h5>&lt;p>虽然可以用nginx反代，但我还是更喜欢用tunnle的方式，因为我的域名已经绑定了cloudflare，直接把我的目标域名&lt;code>https://vaultwarden.tama.guru&lt;/code>引导到&lt;code>http://127.0.0.1:8000&lt;/code>即可，现在就可以通过&lt;code>https://vaultwarden.tama.guru&lt;/code>访问vaultwarden了。&lt;/p>
&lt;h4 id="其他">其他
&lt;/h4>&lt;p>登录后新建完用户，一般来说是要把注册权限关掉的，可以登录&lt;code>https://vaultwarden.tama.guru/admin&lt;/code>，&lt;code>admin_token&lt;/code>即时之前我们配置的&lt;code>vaultwarden.env&lt;/code>中的&lt;code>ADMIN_TOKEN&lt;/code>。登录进去之后找到&lt;code>SIGNUPS_ALLOWED&lt;/code>的配置项，默认是打勾的，取消掉保存即可。&lt;/p>
&lt;p>然后我们需要关掉管理面板的访问，去&lt;code>/var/lib/vaultwarden/data/config.conf&lt;/code>找到&lt;code>admin_token&lt;/code>这一行，直接删掉整行保存，再执行&lt;code>systemctl restart vaultwarden&lt;/code>即可。&lt;/p>
&lt;p>因为我使用的编译环境是Ubuntu22.04，glibc版本是2.35，如果系统glibc版本低于2.35的就建议自己编译吧，不然是执行不了的。查询系统glibc版本：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ ldd --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ldd &lt;span class="o">(&lt;/span>GNU libc&lt;span class="o">)&lt;/span> 2.36
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>狼的公告板功能更新：探索和标签</title><link>https://blog.tama.guru/record/tamabox-tags.html</link><pubDate>Thu, 26 Feb 2026 18:00:00 +0800</pubDate><guid>https://blog.tama.guru/record/tamabox-tags.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 狼的公告板功能更新：探索和标签" />&lt;h4 id="前言">前言
&lt;/h4>&lt;p>新年好！2026年给提问箱加了点小功能，最开始是我想起来曾经有一位水友在群里问我，我开通了提问箱，为啥没有人给我提问？对于NekoBox这个项目来说，最开始的时候往外分享出去的方式只有链接，再后来我结合现有资源弄了个二维码并不断优化。（但是对于大多数人来说，扫码工具无非就是微信和QQ，而这俩东西是带白名单机制的，本站域名因为不在白名单内，经常是需要扫码完再手动复制链接到浏览器访问，还是有点复杂。）而无论是链接访问还是扫码访问，这都需要提问箱的箱主主动去分享，上面这个水友则是想要一种被动得到提问的形式，所以我选择添加这个探索的功能。&lt;/p>
&lt;h4 id="如何使用">如何使用
&lt;/h4>&lt;p>登录后在用户设置页面底部的标签设置模块，目前我设置的是允许给自己写下五个标签，每个标签五个字之内，可以写任何东西，这里可以写一些希望大家知道你特长的板块，这样你的主页就会在探索页面展现出来。当然这个功能是默认关闭的，如果不开启“在首页展示我的标签”则不会显示。探索页面位于：&lt;a href="https://box.tama.guru/explore">探索用户&lt;/a>。&lt;/p>
&lt;p>&lt;img src="https://cloudpaste.0c99c40b475a65b393abaca3ca91731b.r2.cloudflarestorage.com/tags-setting.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&amp;X-Amz-Credential=b63a8e64f5981e223ca1fe95c25d4dcd%2F20260226%2Fapac%2Fs3%2Faws4_request&amp;X-Amz-Date=20260226T102324Z&amp;X-Amz-Expires=3600&amp;X-Amz-Signature=1d0544918db9970d9166d637e18f67d973d6e2c2322e954e3d945f7d86ce740f&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3D%22tags-setting.png%22&amp;response-content-type=image%2Fpng&amp;x-id=GetObject" alt="image" />&lt;br>&lt;/p>
&lt;p>&lt;img src="https://cloudpaste.0c99c40b475a65b393abaca3ca91731b.r2.cloudflarestorage.com/explore.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&amp;X-Amz-Credential=b63a8e64f5981e223ca1fe95c25d4dcd%2F20260226%2Fapac%2Fs3%2Faws4_request&amp;X-Amz-Date=20260226T102504Z&amp;X-Amz-Expires=3600&amp;X-Amz-Signature=4bc84c2d837c0de9cfc668f70f4f33818d63144bf097d7de0cdc13f7109bf7f7&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3D%22explore.png%22&amp;response-content-type=image%2Fpng&amp;x-id=GetObject" alt="image" />&lt;br>&lt;/p>
&lt;p>如果大家有什么新的想法可以提出来，我尽量修改。
欢迎大家注册使用：&lt;a href="https://box.tama.guru">狼的提问箱&lt;/a>。&lt;/p></description></item><item><title>狼的提问箱数据库已迁移至PostgreSQL</title><link>https://blog.tama.guru/record/tamabox-database-move-to-postgres.html</link><pubDate>Tue, 30 Dec 2025 17:32:11 +0800</pubDate><guid>https://blog.tama.guru/record/tamabox-database-move-to-postgres.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 狼的提问箱数据库已迁移至PostgreSQL" />&lt;p>其实原作者很早之前就写好了打通PostgreSQL的代码，只是我一直没啥时间弄，最近趁着年末最忙的时候想找点乐子释放下压力，就干脆把数据库迁移过来了。
迁移到PostgreSQL算是大势所趋吧，目前还在运行的几个项目中基本上都在使用这个数据库（之前还有部分部署在vercel上因为无法访问的原因也一并迁移到本地部署，而MySQL上就还存着提问箱的数据没别的东西了，对于服务器资源紧张的现状来说为了提问箱单独跑个MySQL也有点多余。&lt;/p>
&lt;p>我有尝试过使用pgloader一类的工具来迁移，但过程并不顺利，最后是使用navicat进行迁移的，写下这篇记录的时候数据库已迁移两个小时，在本地测试一切功能正常直接就放上线了。操作也很简单，大部分步骤参照原作者博客中的内容：&lt;a class="link" href="https://github.red/nekobox-refactor/" target="_blank" rel="noopener"
>再看 NekoBox：迁移、重构、展望 - Light Cube&lt;/a>，再根据我迁移过程中碰到的问题整理而成。&lt;br>
1.下载安装navicat，并配置好MySQL和PostgreSQL的数据库连接信息。&lt;br>
2. 在PostgreSQL右键新建数据库命令新建一个名称为&lt;code>nekobox&lt;/code>的数据库，然后新建一个查询来新建关系：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-SQL" data-lang="SQL">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SCHEMA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nekobox&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>3.使用&lt;code>工具-数据传输&lt;/code>功能，源选定为MySQL下的原数据库，目标为PostgreSQL下的nekobox数据库，模式选为nekobox，然后选定所有的表执行迁移，根据数据量大小可能花点时间。
4.检查下把迁移是否把MySQL &lt;code>tinyint(2)&lt;/code> 类型迁移成了 Postgres &lt;code>smallint&lt;/code> 类型，而非 &lt;code>bool&lt;/code> 类型，如有就手动修改它的类型：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-SQL" data-lang="SQL">&lt;span class="line">&lt;span class="cl">&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="s2">&amp;#34;questions&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COLUMN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">is_private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TYPE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">BOOLEAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CASE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">is_private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">THEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FALSE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">ELSE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TRUE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">END&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="s2">&amp;#34;censor_logs&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COLUMN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TYPE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">BOOLEAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CASE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">THEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FALSE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">ELSE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TRUE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">END&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>5.解决迁移过程中没有把自增序列迁移过来的问题：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-SQL" data-lang="SQL">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 1. 查看当前最大 ID（先确认数据）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">MAX&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- 2. 创建序列并设置起始值（假设最大 id 是 1000）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SEQUENCE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">users_id_seq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">START&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1001&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- 3. 将序列绑定到 id 列
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COLUMN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DEFAULT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nextval&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;nekobox.users_id_seq&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- 4. 将序列的所有权给表（表删除时序列也删除）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SEQUENCE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">users_id_seq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OWNED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;nekobox&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>6.因为更新之后的源码已经不需要&lt;code>content_censor_pass&lt;/code>和&lt;code>answer_censor_pass&lt;/code>的数据，还需要手动删除：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-SQL" data-lang="SQL">&lt;span class="line">&lt;span class="cl">&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">questions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COLUMN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">content_censor_pass&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">questions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">COLUMN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">answer_censor_pass&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改完以上内容之后，clone源码到本地重新编译就正常运行了。&lt;/p></description></item><item><title>记录一些使用CloudFlare CNAME优选加速碰到的问题</title><link>https://blog.tama.guru/record/cloudflare-cname-issus.html</link><pubDate>Fri, 21 Nov 2025 15:35:11 +0800</pubDate><guid>https://blog.tama.guru/record/cloudflare-cname-issus.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 记录一些使用CloudFlare CNAME优选加速碰到的问题" />&lt;p>本站多数服务都是通过CloudFlare提供的CDN服务实现加&lt;del>减&lt;/del>速，默认配置在多数情况下对于我提供的轻量服务也基本够用，一些比较重的资源比如自建图床、静态资源挂在阿里云OSS上，但前几天CloudFlare全球大面积崩溃导致部分服务无法使用（控制台都上不去，想切出来都切不了），在服务恢复后我对现存的几个服务做比较分析，发现之前使用CNAME优选加速的提问箱整体速度要比公告板和分享盘要快很多，而后两者一个是通过CloudFlare Pages的默认CNAME，一个是直接点开小云朵加速，于是我决定花点时间将所有的服务都切换使用CNAME优选加速，在过程中碰到的些许问题在此记录。&lt;/p>
&lt;h4 id="通用加速前提">通用加速前提
&lt;/h4>&lt;p>前提就是要有两个域名，一个需要绑定在CloudFlare上，另一个可以放在其他类似腾讯云的平台，方便做分线路解析。以我自己为例，我绑定在CloudFlare上的域名是337845818.best，先在域名下的&lt;code>DNS &amp;gt; 记录&lt;/code>下新增一个用作回退源的解析，比如我设置如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">类型&lt;/span>&lt;span class="o">=&lt;/span>A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">名称&lt;/span>&lt;span class="o">=&lt;/span>origin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">内容&lt;/span>&lt;span class="o">=&lt;/span>服务器IP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">代理状态&lt;/span>&lt;span class="o">=&lt;/span>已代理
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TTL&lt;/span>&lt;span class="o">=&lt;/span>自动
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这样就添加了一个指向服务器IP的源&lt;code>origin.337845818.best&lt;/code>。
然后在&lt;code>SSL/TLS &amp;gt; 自定义主机名&lt;/code>中设置回退源为&lt;code>origin.337845818.best&lt;/code>，刷新等待回退源状态变为&lt;code>有效&lt;/code>。
这种情况下就可以通过&lt;code>SSL/TLS &amp;gt; 自定义主机名&lt;/code>中的&lt;code>添加自定义主机名&lt;/code>实现解析到服务器IP上的服务。比如添加一个提问箱的自定义服务，首先需要在&lt;code>DNS &amp;gt; 记录&lt;/code>中新增一个解析，比如&lt;code>box.337845818.best&lt;/code>，这个A记录直接指向服务器并点开小黄云，然后在&lt;code>SSL/TLS &amp;gt; 自定义主机名&lt;/code>中的&lt;code>添加自定义主机名&lt;/code>内设置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">自定义主机名&lt;/span>&lt;span class="o">=&lt;/span>box.tama.guru
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">最低TLS版本&lt;/span>&lt;span class="o">=&lt;/span>TLS1.0（默认）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">证书类型&lt;/span>&lt;span class="o">=&lt;/span>由CloudFlare提供
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">证书验证方法&lt;/span>&lt;span class="o">=&lt;/span>TXT验证（推荐）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">自定义源服务器&lt;/span>&lt;span class="o">=&lt;/span>box.337845818.best
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后会得到两组TXT用于域名核验，我的&lt;code>tama.guru&lt;/code>域名绑定的是DNSPOD，所以需要在DNSPOD上把这两组TXT添加到解析，并等待刷新提示证书状态为有效且主机名状态为有效，然后就可以在DNSPOD添加两组CNAME解析：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">主机记录&lt;/span>&lt;span class="o">=&lt;/span>box
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">记录类型&lt;/span>&lt;span class="o">=&lt;/span>CNAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">线路类型&lt;/span>&lt;span class="o">=&lt;/span>默认
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">记录值&lt;/span>&lt;span class="o">=&lt;/span>box.337845818.best
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TTL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">600&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">主机记录&lt;/span>&lt;span class="o">=&lt;/span>box
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">记录类型&lt;/span>&lt;span class="o">=&lt;/span>CNAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">线路类型&lt;/span>&lt;span class="o">=&lt;/span>境内
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">记录值&lt;/span>&lt;span class="o">=&lt;/span>tamabox.cloudflare.182682.xyz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TTL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">600&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这里的&lt;code>visa.cn&lt;/code>即为优选域名，网上有很多可以自己找找适合自己的。这样设置之后一段时间后可以通过dig命令查询是否生效：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">~$ dig box.tama.guru
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;&lt;/span> &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.18.33-1~deb12u2-Debian &amp;lt;&amp;lt;&amp;gt;&amp;gt; box.tama.guru
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> global options: +cmd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> Got answer:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> -&amp;gt;&amp;gt;HEADER&lt;span class="s">&amp;lt;&amp;lt;- opco&lt;/span>de: QUERY, status: NOERROR, id: &lt;span class="m">48864&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> flags: qr rd ra&lt;span class="p">;&lt;/span> QUERY: 1, ANSWER: 7, AUTHORITY: 0, ADDITIONAL: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> OPT PSEUDOSECTION:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;&lt;/span> EDNS: version: 0, flags:&lt;span class="p">;&lt;/span> udp: &lt;span class="m">1232&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> QUESTION SECTION:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;&lt;/span>box.tama.guru. IN A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> ANSWER SECTION:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">box.tama.guru. &lt;span class="m">539&lt;/span> IN CNAME tamabox.cloudflare.182682.xyz.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tamabox.cloudflare.182682.xyz. &lt;span class="m">9&lt;/span> IN CNAME 我爱学习壹.cloudflare.182682.xyz.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> Query time: &lt;span class="m">63&lt;/span> msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> SERVER: 223.5.5.5#53&lt;span class="o">(&lt;/span>223.5.5.5&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>UDP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> WHEN: Fri Nov &lt;span class="m">21&lt;/span> 10:51:58 CST &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">;;&lt;/span> MSG SIZE rcvd: &lt;span class="m">410&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看到应答结果叽里咕噜叽里咕噜添加一堆东西，然后通过&lt;code>ping.cn&lt;/code>之类的工具查询域名&lt;code>box.tama.guru&lt;/code>，全国都很绿了。&lt;/p>
&lt;h4 id="pages加速">Pages加速
&lt;/h4>&lt;p>在设置好的Pages下找到自定义域，比如我把公告板服务解析到&lt;code>blog.tama.guru&lt;/code>，然后到DNSPOD一样添加两组CNAME解析，一组指向默认的&lt;code>***.pages.dev&lt;/code>，另一组设置区域为境内，指向优选CNAME，这样就实现了分流。&lt;/p>
&lt;h4 id="worker加速">Worker加速
&lt;/h4>&lt;p>比如我有一个worker名称设定为60S，先在域名下的&lt;code>DNS &amp;gt; 记录&lt;/code>下新增一个CNAME解析，指向优选域名，比如：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">类型&lt;/span>&lt;span class="o">=&lt;/span>CNAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">名称&lt;/span>&lt;span class="o">=&lt;/span>60s-cname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">内容&lt;/span>&lt;span class="o">=&lt;/span>cloudflare-proxy.cloudflare.182682.xyz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">代理状态&lt;/span>&lt;span class="o">=&lt;/span>**仅DNS**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TTL&lt;/span>&lt;span class="o">=&lt;/span>自动
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注意代理状态是仅DNS，这样可以得到一个&lt;code>60s-cname.337845818.best&lt;/code>的加速域名。然后在域名下的&lt;code>Workers路由&lt;/code>新增一条&lt;code>HTTP路由&lt;/code> ，路由为&lt;code>60s-cname.337845818.best/*&lt;/code>，worker选择&lt;code>60S&lt;/code>，保存生效后就可以通过&lt;code>60s-cname.337845818.best&lt;/code>这个域名加速访问到这个Worker。当然，这样只适用于域名绑定在CloudFlare上的情况。&lt;/p>
&lt;h4 id="qa">QA
&lt;/h4>&lt;p>Q：通用加速可以让多个服务器使用吗？&lt;br>
A：不能，因为只有一个回退源，而这个源指向的是单独的IP，就算添加了自定义主机名也只能指向这个服务器IP提供的服务，如果有多个服务器IP就要有多个CloudFlare账号来操作。&lt;/p>
&lt;p>Q：自定义主机名提示&lt;code>custom hostname does not CNAME to this zone.&lt;/code>&lt;br>
A：到DNSPOD检查一下是否有增加目标域名解析，比如自定义主机名设置了&lt;code>share.tama.guru&lt;/code>-&amp;gt;&lt;code>share.337845818.best&lt;/code>，则在DNSPOD添加名为&lt;code>share&lt;/code>指向&lt;code>share.337845818.best&lt;/code>的CNAME解析。&lt;/p>
&lt;p>Q：自定义主机名提示&lt;code>The custom origin hostname you specified is a gray clouded DNS record. Please update the record to be proxied.&lt;/code>&lt;br>
A:CloudFlare不支持没有代理的目标域名做自定义主机源，需要到CloudFlare的DNS解析中找到对应的域名把&lt;code>仅DNS&lt;/code>改成&lt;code>代理&lt;/code>。&lt;/p>
&lt;p>Q：访问代理网站提示&lt;code>ERR_TOO_MANY_REDIRECTS&lt;/code>&lt;br>
A：检查CloudFlare上域名的&lt;code>SSL/TLS &amp;gt; 概览&lt;/code>中SSL/TLS加密方式，确保为自动SSL/TLS（默认）或者完全模式。&lt;/p></description></item><item><title>自用的windows+archlinux双系统安装过程（在gpd win mini 2024上验证通过）</title><link>https://blog.tama.guru/record/dual-system-on-gpd-win-mini.html</link><pubDate>Tue, 11 Nov 2025 11:11:11 +0800</pubDate><guid>https://blog.tama.guru/record/dual-system-on-gpd-win-mini.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 自用的windows+archlinux双系统安装过程（在gpd win mini 2024上验证通过）" />&lt;p>如果是全新安装双系统，个人建议还是先安装linux部分再安装windows，因为这样可以直接调整efi分区大小，如果先安装windows系统就会出现efi分区只有100M的情况，对于动辄几十兆的linux内核来说属实是不够的，还需要进PE系统使用diskgeniues之类的工具重建efi，有可能会导致无法启动。&lt;/p>
&lt;h4 id="archlinux安装">Archlinux安装
&lt;/h4>&lt;p>首先是使用rufus刻录到U盘，直接使用默认的配置dd写入即可，如果使用ventoy的方式安装的话可能会出现找不到init导致安装无法进行。&lt;/p>
&lt;h5 id="连接网络并同步时间">连接网络并同步时间
&lt;/h5>&lt;p>输入&lt;code>iwctl&lt;/code>进入 iwd 的控制台, 然后依次键入如下命令:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">device list &lt;span class="c1"># 列出可用无线网卡, 我这里输出的是 wlan0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">station wlan0 scan &lt;span class="c1"># 扫描附近的无线网络&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">station wlan0 get-networks &lt;span class="c1"># 列出扫描到的网络&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">station wlan0 connect &lt;span class="o">{&lt;/span>SSID&lt;span class="o">}&lt;/span> &lt;span class="c1"># 连接指定网络, 这里我连的是手机热点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span> &lt;span class="c1"># 退出 iwd 控制台&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后, 输入 &lt;code>ping www.baidu.com&lt;/code> 测试是否成功联网.&lt;/p>
&lt;p>联网后, 输入如下命令设置时间为 UTC 并完成 NTP 时间同步:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">hwclock --systohc --utc &lt;span class="c1"># 设置时间为 UTC &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">timedatectl set-ntp &lt;span class="nb">true&lt;/span> &lt;span class="c1"># 完成 NTP 时间同步&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="使用ssh执行安装">使用SSH执行安装
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ip -brief address &lt;span class="c1"># 查询IP地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd &lt;span class="c1"># 修改密码&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>之后就在其他电脑上用ssh客户端连接&lt;code>root@ip:22&lt;/code>，密码就是passwd的密码。因为gpd win mini的键盘实在太小了，避免误操作~~（其实是方便ctrl+c和ctrl+v）~~。&lt;/p>
&lt;h5 id="分区">分区
&lt;/h5>&lt;p>我仅保证基础的系统运行需求，只配置了：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">EFI 600M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SWAP 8G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ROOT Linux root &lt;span class="o">(&lt;/span>x86-64&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果有把home单独分开的习惯另行建立一个linuxfilesystem的分区就行了，但我不需要。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">fdisk -l &lt;span class="c1"># 查看硬盘和分区目录，机器上配置单块nvme，显示为nvme0n1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cfdisk /dev/nvme0n1 &lt;span class="c1"># 使用cfdisk进行分区操作，操作简单&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fdisk -l &lt;span class="c1"># 查看硬盘和分区目录是否配置生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Device Start End Sectors Size Type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/nvme0n1p1 &lt;span class="m">2048&lt;/span> &lt;span class="m">1230847&lt;/span> &lt;span class="m">1228800&lt;/span> 600M EFI System
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/nvme0n1p2 &lt;span class="m">1230848&lt;/span> &lt;span class="m">18008063&lt;/span> &lt;span class="m">16777216&lt;/span> 8G Linux swap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/nvme0n1p3 &lt;span class="m">18008064&lt;/span> &lt;span class="m">353552383&lt;/span> &lt;span class="m">335544320&lt;/span> 160G Linux root &lt;span class="o">(&lt;/span>x86-64&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkfs.vfat -F32 /dev/nvme0n1p1 &lt;span class="c1"># 格式化efi分区为fat32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkswap /dev/nvme0n1p2 &lt;span class="c1"># 配置swap分区&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkfs.ext4 /dev/nvme0n1p3 &lt;span class="c1"># 格式化root为ext4，如果使用其他格式另说&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/nvme0n1p3 /mnt &lt;span class="c1"># 挂载root分区到/mnt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /mnt/boot &lt;span class="c1"># 在root分区下新建boot文件夹用于挂载efi分区&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/nvme0n1p1 /mnt/boot &lt;span class="c1"># 挂载efi分区到/boot目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swapon /dev/nvme0n1p2 &lt;span class="c1"># 启用swap分区&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="安装基本系统">安装基本系统
&lt;/h5>&lt;p>安装基础软件并配置fstab挂载&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -L -o /etc/pacman.d/mirrorlist &lt;span class="s2">&amp;#34;https://archlinux.org/mirrorlist/?country=CN&amp;#34;&lt;/span> &lt;span class="c1"># 抓取archlinux.org上的mirrorlist文件保存本地&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/pacman.d/mirrorlist &lt;span class="c1"># 该文件包含基本上国内所有活跃的源，删掉前面的#即可，一般留个三四个https开头的就行了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -Syy &lt;span class="c1"># 更新索引&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">LANG&lt;/span>&lt;span class="o">=&lt;/span>C &lt;span class="c1">#避免乱码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacstrap /mnt base linux linux-firmware bash-completion e2fsprogs nano networkmanager pacman-contrib sudo amd-ucode intel-ucode sof-firmware &lt;span class="c1">#安装基础软件，实体机器安装时根据cpu安装 amd-ucode或intel-ucode，一起安装也没事就是了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">genfstab -U /mnt &amp;gt;&amp;gt; /mnt/etc/fstab &lt;span class="c1"># 生成fstab文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arch-chroot /mnt &lt;span class="c1"># 切换到新系统&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="系统初始化设置">系统初始化设置
&lt;/h5>&lt;p>主要是一些时区、hostname、语言、新建用户等基础设置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &lt;span class="c1"># 修改时区为上海&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hwclock --systohc &lt;span class="c1"># 系统时间同步到硬件时钟&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> miniarch &amp;gt; /etc/hostname &lt;span class="c1"># 修改hostname，这里和下一步相关联&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/hosts &lt;span class="c1">#编 辑host解析&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">::1 localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1 miniarch &lt;span class="c1"># 添加ipv4解析到hostname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">::1 miniarch &lt;span class="c1"># 添加ipv6解析到hostname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/locale.gen &lt;span class="c1"># 修改多语言设置，建议使用en_US.UTF-8和zh_CN.UTF-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">locale-gen &lt;span class="c1"># 使多语言设置文件生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">LANG&lt;/span>&lt;span class="o">=&lt;/span>en_US.UTF-8 &amp;gt; /etc/locale.conf &lt;span class="c1"># 设置默认语言，使用en_US.UTF-8是避免显示乱码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SUDO_EDITOR&lt;/span>&lt;span class="o">=&lt;/span>nano visudo &lt;span class="c1"># 修改sudo设置，把%wheel ALL=(ALL) ALL前面的#删掉&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd -m -G wheel -s /bin/bash admin &lt;span class="c1"># 增加新用户并添加到wheel组&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd admin &lt;span class="c1"># 修改新用户密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -S grub &lt;span class="c1"># 安装grub&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -S grub efibootmgr os-prober &lt;span class="c1"># 安装用于多系统的配套软件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">grub-install --target&lt;span class="o">=&lt;/span>x86_64-efi --efi-directory&lt;span class="o">=&lt;/span>/boot --bootloader-id&lt;span class="o">=&lt;/span>grub --recheck &lt;span class="c1"># 在grub增加一个efi分区指向boot目录的启动项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;GRUB_DISABLE_OS_PROBER=false&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/default/grub &lt;span class="c1"># 启用os-prober&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">grub-mkconfig -o /boot/grub/grub.cfg &lt;span class="c1"># 生成grub配置&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="配置基础功能">配置基础功能
&lt;/h5>&lt;p>图形化界面和字体、基础软件的安装和配套设置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">pacman -S --noconfirm plasma sddm konsole noto-fonts noto-fonts-cjk noto-fonts-emoji openssh dhcpcd &lt;span class="c1"># 安装kde+plasma+基础字体+openssh+dhcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pacman -S --asdeps gst-plugins-good power-profiles-daemon &lt;span class="c1"># 补齐配套软件，power-profiles-daemon用于管理电源配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> NetworkManager &lt;span class="c1"># 启用NetworkManager&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> sddm &lt;span class="c1"># 启用sddm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> sshd &lt;span class="c1"># 启用ssh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl disable NetworkManager-wait-online &lt;span class="c1"># 服务用于确保网络连接在启动过程中达到“在线”状态后，才允许依赖网络的其他服务启动，没必要使用。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">timedatectl set-ntp &lt;span class="nb">true&lt;/span> &lt;span class="c1"># 启用ntp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> systemd-resolved &lt;span class="c1"># 启用本地解析&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> dhcpcd &lt;span class="c1"># 启用dhcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf &lt;span class="c1"># 可能会提示已经做过链接了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span> &lt;span class="c1"># 退出当前环境&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">umount -R /mnt &lt;span class="c1"># 卸载/mnt和/mnt/boot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot &lt;span class="c1"># 重启系统&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>重启后就可以使用图形界面登录了。&lt;/p>
&lt;h5 id="进入系统后一些设置">进入系统后一些设置
&lt;/h5>&lt;p>安装完系统后依旧可以使用ssh远程操作，如果需要修改ssh配置就修改&lt;code>/etc/ssh/sshd_config&lt;/code>。&lt;/p>
&lt;h6 id="安装输入法">安装输入法
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo pacman -S fcitx5-im fcitx5-chinese-addons &lt;span class="c1"># 安装输入法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nano /etc/environment &lt;span class="c1">#配置使用输入法，把下面&amp;gt;&amp;gt;&amp;gt;之间的内容添加到这个文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">GTK_IM_MODULE&lt;/span>&lt;span class="o">=&lt;/span>fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">QT_IM_MODULE&lt;/span>&lt;span class="o">=&lt;/span>fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">XMODIFIERS&lt;/span>&lt;span class="o">=&lt;/span>@im&lt;span class="o">=&lt;/span>fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SDL_IM_MODULE&lt;/span>&lt;span class="o">=&lt;/span>fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="修改启动界面语言">修改启动界面语言
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo &lt;span class="nv">SYSTEMD_EDITOR&lt;/span>&lt;span class="o">=&lt;/span>nano systemctl edit sddm &lt;span class="c1"># 修改启动界面语言，把&amp;gt;&amp;gt;&amp;gt;之间的内容添加到第三行起的空行中。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">LANG&lt;/span>&lt;span class="o">=&lt;/span>zh_CN.UTF-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="安装rust并换源">安装rust并换源
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo pacman -S rustup &lt;span class="c1">#使用rustup安装rust&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano ~/.cargo/config.toml &lt;span class="c1"># 修改默认索引源为中科大的，速度快很多，编辑这个文件把&amp;gt;&amp;gt;&amp;gt;之间的内容添加进去，.cargo目录默认也是没有的，要自己新建&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>source.crates-io&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replace-with &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;ustc&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>source.ustc&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">registry&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;git://mirrors.ustc.edu.cn/crates.io-index&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>net&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git-fetch-with-cli &lt;span class="o">=&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano ~/.bashrc &lt;span class="c1"># 添加环境变量，&amp;gt;&amp;gt;之间的内容添加到最后即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">RUSTUP_DIST_SERVER&lt;/span>&lt;span class="o">=&lt;/span>https://mirrors.ustc.edu.cn/rust-static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">RUSTUP_UPDATE_ROOT&lt;/span>&lt;span class="o">=&lt;/span>https://mirrors.ustc.edu.cn/rust-static/rustup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">source&lt;/span> ~/.bashrc &lt;span class="c1"># 使环境变量生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rustup default stable &lt;span class="c1"># 安装rust&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="安装paru">安装paru
&lt;/h6>&lt;p>yay还是paru都可以，个人更习惯paru，上面安装rust主要也是因为paru是用rust写的，不换源安装会非常的久。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo pacman -S --needed base-devel git &lt;span class="c1"># 安装编译所需套件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git clone https://aur.archlinux.org/paru.git &lt;span class="c1"># 拉取源码到本地&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> paru &lt;span class="c1"># 进入源码目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">makepkg -si &lt;span class="c1"># 开始编译安装&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="安装golang并配置代理">安装golang并配置代理
&lt;/h6>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo pacman -S go &lt;span class="c1"># 安装go&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go env -w &lt;span class="nv">GO111MODULE&lt;/span>&lt;span class="o">=&lt;/span>on &lt;span class="c1"># 启用 Go Modules 功能&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">go env -w &lt;span class="nv">GOPROXY&lt;/span>&lt;span class="o">=&lt;/span>https://goproxy.cn,direct &lt;span class="c1">#切换使用七牛云做代理源&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="安装steam">安装steam
&lt;/h5>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo nano /etc/pacman.conf &lt;span class="c1">#启用multilib支持，删除掉[multilib]部分前面的#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>multilib&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Include&lt;/span> &lt;span class="o">=&lt;/span> /etc/pacman.d/mirrorlist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S steam &lt;span class="c1"># 安装steam&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">steam &lt;span class="c1">#安装完执行一次steam来拉取安装包，安装过程中使用ssh还是本地终端都行，但是使用ssh安装完会提示找不到x环境，不影响&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>至此，基本的archlinux环境已经安装完成。&lt;/p>
&lt;h4 id="安装windows-11-ltsc">安装Windows 11 LTSC
&lt;/h4>&lt;p>其实安装啥版本都行，使用ltsc是因为没有那些杂七杂八的功能，更新也少一些，使用rufus或者ventoy安装都可以，这里主要讲安装完成后的一些必要操作。正常安装进入系统后先不要急着联网，首先进设备管理器可以看到一堆感叹号，但是&lt;strong>千万不要把驱动全部安装，不然大概率会在后续重启后死循环！&lt;/strong>&lt;/p>
&lt;h6 id="注意amd-drtm-boot-driver驱动问题">注意AMD DRTM Boot Driver驱动问题
&lt;/h6>&lt;p>未安装驱动中有一项（一般是最后一项）显示是未知设备的，详细信息中设备实例路径是&lt;code>ACPI\DRTM00001\0&lt;/code>，实际是叫&lt;code>AMD DRTM Boot Driver&lt;/code>的东西，如果使用AMD Chipset Drivers安装驱动会默认把这一项一起安装，千万要记得到设备管理器里面卸载这一项的驱动并且停用这个设备。&lt;br>
这个驱动貌似和安全启动相关，但是无论我开启安全启动还是关闭安全启动，只要安装这个就会在下次重启无法进入系统，具体症状就是开机后使用Windows Boot Manager不能进入系统加载（就是转圈圈），然后黑屏自动重启，多次之后掉到自动修复但是修复提示失败；如果使用refind或者grub的启动项进去会提示&lt;code>0xc0000001&lt;/code>启动失败，具体原因目前我也找不到资料，所以建议是千万不要去动这个东西。一开始我还以为是系统问题，但是无论是官方的固件还是最新WIN11、LTSC都有复现，所以从更新的角度去考虑，我进PE用dism++把安装的驱动一项项排除发现只要把系统设备下的amddrtm.inf删掉问题就解决了，所以很明显就是这个&lt;code>AMD DRTM Boot Driver&lt;/code>的问题。&lt;br>
所以在安装好系统后，一是停用设备，二是避免安装这个驱动。最好就是针对性的屏蔽这个设备的驱动安装，先在设备管理器里右键这个设备找到详细信息&amp;gt;类Guid，这是一个用{}包括起来的值，右键复制，然后到组策略的&lt;code>计算机配置&amp;gt;管理模版&amp;gt;系统&amp;gt;设备安装&amp;gt;设备安装限制&lt;/code>，找到&lt;code>阻止使用与下列设备安装程序类相匹配的驱动程序安装设备&lt;/code>，切换到已启用，并在下方的显示中把上面的类Guid复制进去并应用，之后应用即可，之后再安装这个设备驱动就会报错提示系统策略禁止安装。目前这么操作几天之后没有发现其他问题。&lt;/p></description></item><item><title>在GPD Win2上装Win11和archlinux双系统的那些事</title><link>https://blog.tama.guru/record/multi-system-on-win2.html</link><pubDate>Tue, 14 Oct 2025 11:09:11 +0800</pubDate><guid>https://blog.tama.guru/record/multi-system-on-win2.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 在GPD Win2上装Win11和archlinux双系统的那些事" />&lt;p>[TOC]&lt;/p>
&lt;h4 id="前言">前言
&lt;/h4>&lt;p>我一直很想找个足够小且带屏幕、满足基本输入方式的X86设备，最早的时候是因为接触到诺基亚的N900，这玩意能够跑linux且自带侧滑键盘，是我理想的形态，但无奈的是硬件性能实在跟不上，且很多软件已经没有维护，最终也只能当个玩具。在这之后，我接触到Steamdeck、N305带屏小主机甚至是刷WIN10改运存的小米平板2，但每个都有不满意的地方，steamdeck屏幕不大但是整体体积很大，而且是为游戏设计的，操作对我来说有点别扭；带屏小主机算是一段时间内我带出门的主力设备，机身接口丰富且整体尺寸控制不错，但是缺少触屏之外的输入方式，也就是真要干活就得自带鼠标键盘；至于小米平板2，小是够小而且可以加装超薄的键盘皮套，但是atom的性能摆在那里，就只能当个玩具玩玩。所以在我发现win2屏幕只有6寸的时候是真的震惊了，而且是翻盖全功能键盘，cpu也是8100y而不是那一众atom，还能加装固态，唯一的问题就是价格离谱，去年前年刚看到的时候一个要千五千八，最近刚看已经降到千元出头，最后找到个九百多乱改过散热和电池导致有点鼓包的。&lt;/p>
&lt;h4 id="上手">上手
&lt;/h4>&lt;p>刚上手的时候是用个小袋子装的，确实小很多，基本上就比手机宽一些，两倍厚度；机身IO相比N305主机少很多，就一个USB3.0+一个TypeC（兼容供电）+外星科技3.5mm接口+MicroHDMI。6寸屏幕在720P分辨率下显示尚可接受，但是操作起来就有点麻烦（主要是系统UI太小了），手柄部分可以切换成鼠标模式，用摇杆模拟滚动，肩键模拟左右键，但是摇杆的灵敏度很低，只能说够应急但是绝对不能说得上用的爽。&lt;br>
姑且跑个分，CPU144150 显卡57990，内存86582，硬盘53269，合计341991，对于这么小尺寸的设备我觉得还是可以接受。&lt;br>
这系统原机主连重置都懒得重置一下，很多个人资料在里面，卖二手设备要注意信息安全啊&amp;hellip;&lt;/p>
&lt;h4 id="换硬盘装win11">换硬盘装WIN11
&lt;/h4>&lt;p>机身带的硬盘只有256G，装个系统剩下也不够干啥了，但这机子固态用的是2242长度，手头上最大的也只有512G，姑且先换一个上去装系统。
我用的是win11的官方ltsb镜像，使用ventoy安装，安装过程中如果使用新版安装器在硬盘检测步骤必定会出现&lt;code>Windows安装遇到错误。错误代码：0x8007001-0x4002F&lt;/code>的问题，必须要切换到旧版安装器。&lt;br>
**注意！在所有驱动安装完成之前先不要联网！**安装完成后进入系统很多硬件都是没有驱动的，特别是触屏，官方虽然发布了触屏修复补丁，但是如果安装那玩意轻则只是触屏错位，重则完全失灵。查一些资料之后在一个帖子（https://tieba.baidu.com/p/7675530378#)下发现类似状况和解决方案，我在这个方案的基础上做一些调整，实现WIN下所有设备驱动正常：&lt;/p>
&lt;p>先修复触屏驱动：&lt;/p>
&lt;ol>
&lt;li>去官网下载V6驱动包、4.4.2.4923版本的触屏驱动和贴吧提供的未签名版本特定驱动到U盘或SD卡上，解压好备用。&lt;/li>
&lt;li>去高级启动中修改启动配置为禁用驱动程序强制签名（F7 / 7），重启进入系统后到解压后的未签名版本特定驱动文件夹下找到.inf文件右键安装，安装过程中会弹出驱动未签名的红色警告，继续安装。安装完此时触摸是正常的，也没有漂移。到设备管理器中检查&lt;code>GoodixTouchDriver Device&lt;/code>版本为14.47.23.751，然后重启。&lt;/li>
&lt;li>重启后触屏再次时效，设备管理器中检查&lt;code>GoodixTouchDriver Device&lt;/code>装填变为无法验证此设备所需的驱动程序的数字签名，再次回到解压后的未签名版本特定驱动文件夹，找到关闭测试模式.bat，运行并重启。（关闭测试模式这一步是否有必要有待考究，也许重启之后就自动关闭了，但原文如此，且不影响我操作，暂且保留）&lt;/li>
&lt;li>进入设备管理器，右键&lt;code>GoodixTouchDriver Device&lt;/code>并选择更新驱动程序，来源选择浏览我的电脑以查找驱动程序，选择官方提供的4.4.2.4923版本的触屏驱动文件夹，等待安装完成，此时触屏已恢复且重启后不会掉驱动，至此触屏驱动修复完成。&lt;/li>
&lt;/ol>
&lt;p>解决其他驱动问题：&lt;/p>
&lt;p>修复完触屏后还剩下10个感叹号，我们需要按照上面的第四点这样操作，手动从电脑中更新驱动，驱动的文件夹选择V6驱动包的解压路径。需要注意显示适配器默认只是Microsoft基本显示适配器，也需要在V6驱动包中安装UHD615的驱动。&lt;/p>
&lt;p>需要注意：&lt;/p>
&lt;p>如果安装完后系统运行正常，还是不要联网，先去&lt;strong>把自动安装硬件驱动更新给关掉&lt;/strong>，参考：&lt;a class="link" href="https://www.sysgeek.cn/disable-driver-updates-in-windows/" target="_blank" rel="noopener"
>如何禁止 Windows 11 自动安装或更新驱动程序 - 系统极客&lt;/a>&lt;/p>
&lt;p>方法 1：禁止 Windows 11 自动安装驱动程序：按&lt;code>Windows + R&lt;/code>快捷键打开「运行」对话框，执行&lt;code>systempropertiesadvanced&lt;/code>打开「系统属性」窗口；切换到「硬件」选项卡，点击「设备安装设置」按钮；在新弹出的窗口中，选择「否」，关闭驱动自动安装功能；最后，点击「保存更改」，让设置生效。&lt;/p>
&lt;p>方法 2：通过组策略阻止「Windows 更新」提供驱动程序 （不建议，会连正常驱动都无法安装）：按Windows + R快捷键打开「运行」对话框，执行gpedit.msc打开组策略编辑器；依次展开「计算机配置」&amp;gt;「管理模板」&amp;gt;「Windows 组件」&amp;gt;「Windows 更新」&amp;gt;「管理从 Windows 更新提供的更新」；双击「Windows 更新不包括驱动程序」策略，将它设置为「已启动」。&lt;/p>
&lt;p>方法 3：通过注册表禁止从「Windows 更新」搜索驱动程序：按Windows + R快捷键打开「运行」对话框，执行regedit打开注册表编辑器，导航到&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverSearching
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>找到名为SearchOrderConfig的 DWORD (32 位) 值，并将其设置为：2 ，即不搜索 Windows 更新。&lt;/p>
&lt;p>之所以这么做，是因为机子自带的无线网卡在通过windows更新驱动时，&lt;strong>100%会导致蓝屏并循环！&lt;/strong>（关键文件：ndis.sys，错误代码： SYSTEM THREAD EXCEPTION NOT HANDLED），如果你不小心联网了，手动重启到安全模式，把&lt;code>C:\Windows\SoftwareDistribution\Download&lt;/code>下的文件全部删除，特别是&lt;code>install&lt;/code>文件夹内的文件，存放的就是系统下载并解压后的网卡驱动。&lt;/p>
&lt;p>当你做完这一切，Win11 on GPD win2算是完全正常运行了，后续的激活和优化根据自己的要求即可。&lt;/p>
&lt;h4 id="双系统安装准确来说是安装archlinux">双系统安装，准确来说是安装archlinux
&lt;/h4>&lt;p>以下是一些注意事项的记录，并不涉及到系统的安装。&lt;/p>
&lt;p>因为这台机器我打算就玩些小游戏，512G也基本够用（实在不够扔内存卡也不是不行），我就把100G空间划出来给linux用。 ，安装前需要先进PE系统用diskgenius把ESP分区文件备份，然后把ESP和MSR都删掉再重建，ESP分区要大于500M。&lt;/p>
&lt;p>一样使用ventoy安装archlinux，需要注意的是安装时选择的是grub安装而不是正常安装（不知道是不是我设备的问题，正常安装会直接显示USB电涌然后找不到init，根本安装不下去）。&lt;/p>
&lt;p>在grub界面时不要直接点install archlinux，先按e调整下参数，具体是找到linux开头的那行的末位添加以下内容：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">modprobe.blacklist&lt;span class="o">=&lt;/span>sdhci_pci sdhci.debug_quirks&lt;span class="o">=&lt;/span>0x8000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这也可能是我机器的问题，因为在安装时终端会一直报错：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">mmc0: Timeout waiting &lt;span class="k">for&lt;/span> hardware cmd interrupt.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查资料后有说是SD卡控制器的问题，我尝试过插拔内存卡都没有效果，只能通过这个方式屏蔽，不然安装过程中会不停报错甚至卡死只能长按电源关机。&lt;/p>
&lt;p>还要注意的是，安装系统时并没有办法直接调用无线网络连接WIFI（iw直接检测不到设备，也扫不出来任何SSID），需要用手机连接上设备共享网络。&lt;/p>
&lt;p>正常安装后触屏、显示、WIFI都是正常的，但是在终端执行&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">dmesg &lt;span class="p">|&lt;/span> grep sd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>发现还是会报一样的错：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">mmc0: Timeout waiting &lt;span class="k">for&lt;/span> hardware cmd interrupt.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我的建议是添加&lt;code>/etc/modprobe.d/blacklist.conf&lt;/code>文件，文件内容是：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">blacklist sdhci
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">blacklist sdhci_pci
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>保存并执行&lt;code>sudo update-initramfs -u&lt;/code>命令生成内核初始化文件。&lt;/p>
&lt;p>安装完后可以用refind之类的做引导或者用grub做引导器。&lt;/p>
&lt;p>更新：如果archlinux的欢迎界面（SDDM）显示的是竖屏而非横屏，可以编辑：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo nano /usr/share/sddm/scripts/Xsetup
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在最后面添加：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">xrandr --output eDP-1 --rotate right
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中eDP-1是屏幕的名称，right表示右转。如果还出现SDDM界面输入密码后黑屏的情况，可以试着执行：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo rm -rf /etc/sddm.conf.d/ ~/.config/sddm/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后重启SDDM服务：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo systemctl restart sddm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果发现SDDM界面变回初始主题但是能正常使用，那就说明原来的主题或者配置文件异常冲突了。&lt;/p></description></item><item><title>狼的小卖部 - 基于 Flask + Jinja2 的进销存与销售管理系统</title><link>https://blog.tama.guru/record/simple_sales_system.html</link><pubDate>Fri, 19 Sep 2025 15:09:11 +0800</pubDate><guid>https://blog.tama.guru/record/simple_sales_system.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 狼的小卖部 - 基于 Flask + Jinja2 的进销存与销售管理系统" />&lt;p>[TOC]&lt;/p>
&lt;h2 id="简介">简介
&lt;/h2>&lt;p>我就是感觉这样一个东西应该会有，但是一直找不到，所以干脆自己写个&amp;hellip;一个使用Python的简约销售管理系统，支持商品、分类、库存、销售流水、用户权限、批量导入、统计报表、仪表盘等功能。适合小规模使用，数据支持sqlite或mysql存储，可能会在某些情况下有用处。
项目地址：https://github.com/tamakyi/simple-sales-system&lt;/p>
&lt;h2 id="一些截图">一些截图
&lt;/h2>&lt;ul>
&lt;li>仪表盘
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/dashboard.png" alt="image" />&lt;br>&lt;/li>
&lt;li>商品管理
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/products.png" alt="image" />&lt;br>&lt;/li>
&lt;li>商品导入
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/products-import.png" alt="image" />&lt;br>&lt;/li>
&lt;li>进销存
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/sales.png" alt="image" />&lt;br>&lt;/li>
&lt;li>移动端进销存
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/sales-simple.png" alt="image" />&lt;br>&lt;/li>
&lt;li>商品分类
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/categories.png" alt="image" />&lt;br>&lt;/li>
&lt;li>用户管理
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/users.png" alt="image" />&lt;br>&lt;/li>
&lt;li>操作记录
&lt;img src="https://bgithub.xyz/tamakyi/simple-sales-system/raw/main/screenshot/logs.png" alt="image" />&lt;/li>
&lt;/ul>
&lt;h2 id="功能特色">功能特色
&lt;/h2>&lt;ul>
&lt;li>商品管理（增删改查，支持图片、批量导入）&lt;/li>
&lt;li>分类管理&lt;/li>
&lt;li>进销存：商品表格展示，直接在行内录入进货/销售（针对移动端单独做优化）&lt;/li>
&lt;li>销售流水、历史/今日销售、库存统计&lt;/li>
&lt;li>销售排行榜、分类饼图、销售数据卡片&lt;/li>
&lt;li>用户权限（管理员/普通用户/审核）&lt;/li>
&lt;li>操作日志&lt;/li>
&lt;li>导出销售报表（Excel）&lt;/li>
&lt;li>支持分页、搜索、图片外链或本地上传&lt;/li>
&lt;li>可选使用sql轻量化存储数据或使用mysql存储&lt;/li>
&lt;li>网页公告&lt;/li>
&lt;li>背景图片&lt;/li>
&lt;li>网页跟踪脚本&lt;/li>
&lt;/ul>
&lt;h2 id="快速开始">快速开始
&lt;/h2>&lt;h3 id="1-安装依赖">1. 安装依赖
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2复制envsample为env并编辑">2.复制.env.sample为.env并编辑
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">UPLOAD_FOLDER&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;static/uploads&amp;#39;&lt;/span> &lt;span class="c1">#图片上传路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SECRET_KEY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mysecretkey&lt;/span> &lt;span class="c1">#安全密钥，建议替换&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SQLALCHEMY_DATABASE_URI&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;sqlite:///sales.db&amp;#39;&lt;/span> &lt;span class="c1"># 使用SQLITE作为数据库时使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SQLALCHEMY_DATABASE_URI&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">pymysql&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">localhost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3306&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">test_sale&lt;/span> &lt;span class="c1"># 使用MYSQL作为数据库时使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">MAX_CONTENT_LENGTH&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2097152&lt;/span> &lt;span class="c1">#最大上传大小，默认2M，即2*1024*1024&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PER_PAGE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="c1"># 商品页面每页体现的商品数量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BACKGROUND_IMAGE_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">xxx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">xxx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">png&lt;/span> &lt;span class="c1"># 默认背景图片地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BACKGROUND_OPACITY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">0.1&lt;/span> &lt;span class="c1"># 背景图片不透明度，范围0-1，越接近0越透明。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BACKGROUND_SIZE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cover&lt;/span> &lt;span class="c1">#背景图片尺寸，默认cover即可，详情查看web css中关于background_size的参数说明。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DASHBOARD_ANNOUNCEMENT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;请注意：系统将于本周五晚进行维护，届时可能无法访问。&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ANNOUNCEMENT_ENABLED&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">True&lt;/span> &lt;span class="c1"># 控制公告是否显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ANALYZE_SCRIPT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> &lt;span class="c1">#分析脚本，建议使用umami&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ANALYZE_ENABLE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">True&lt;/span> &lt;span class="c1">#开启分析脚本功能&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-启动项目">2. 启动项目
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">python app-mysql.py &lt;span class="c1">#使用mysql存储数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python app-sqlite.py &lt;span class="c1">#使用sqlite存储数据&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-访问地址">3. 访问地址
&lt;/h3>&lt;p>浏览器打开 &lt;a class="link" href="http://localhost:5000/" target="_blank" rel="noopener"
>http://localhost:5000/&lt;/a>&lt;/p>
&lt;h3 id="4-初始管理员">4. 初始管理员
&lt;/h3>&lt;ul>
&lt;li>用户名：admin&lt;/li>
&lt;li>密码：admin&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="批量导入商品">批量导入商品
&lt;/h2>&lt;p>支持 CSV 批量导入，&lt;strong>需包含下列列名：&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>商品名、单价、库存、分类&lt;/li>
&lt;/ul>
&lt;p>示例见 &lt;code>sample_products.csv&lt;/code>。
网页内支持直接导出模板文件，修改好导入即可实现批量导入。&lt;/p>
&lt;h2 id="测试">测试
&lt;/h2>&lt;ul>
&lt;li>当前已在Debian12 + conda python 3.11 下测试通过。&lt;/li>
&lt;/ul></description></item><item><title>使用Alpine linux在爱快中作为虚拟机运行Docker</title><link>https://blog.tama.guru/record/alpine_docker_on_ikuai.html</link><pubDate>Tue, 09 Sep 2025 15:09:11 +0800</pubDate><guid>https://blog.tama.guru/record/alpine_docker_on_ikuai.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 使用Alpine linux在爱快中作为虚拟机运行Docker" />&lt;p>[TOC]&lt;/p>
&lt;h4 id="前言">前言
&lt;/h4>&lt;p>  自从爱快添加Docker插件之后我有第一时间就安装，使用一段时间后感觉这玩意问题蛮多的，首先就是功能残废，系统提供的界面只能实现修改镜像源、配置存储位置这些基础功能（修改镜像源还是最近几个版本才添加，原来直连官方国内已经无法访问）；然后就是访问异常，我使用Chromium内核的浏览器（包括但不限于Chrome、Edge）访问Docker的管理页面，总是会莫名其妙的跳出来，每点一下就跳一次，拉个镜像配置完参数硬是要花我几分钟时间。而且Docker功能需要到云服务端去手动开启，一直搞不懂为什么要这样。&lt;br>
  但是现在多个路子，就是通过自带的虚拟机虚拟linux环境专门来跑docker，听说它自带的虚拟机也有一些问题，长期使用会影响到宿主系统的性能，但是我使用一段时间之后并没有感觉，日常使用占用CPU最多也就跑到40%，内存我限制了1G，感觉基本够用了。
  我使用的是某鱼上购入的双网口j1900+4G+32G MSata主板作为旁路由，原来用的是基于openwrt的istore，功能很全面，使用起来也很简单，日常维护甚至不需要进ssh，但是我监控家中的网络时发现这个软路由总是莫名其妙的掉线，好在下级做过故障转移，旁路由挂的时候AP能够直接过光猫，不然家里老人断网了我都不知道怎么和他们解释。&lt;br>
  之所以用Alpine是因为它有专门针对虚拟机的版本，体积仅有65M，安装完占用硬盘不到300M，但是能全功能安装Docker甚至其他软件，对于j1900+4G这种配置再合适不过了。&lt;/p>
&lt;h4 id="准备工作">准备工作
&lt;/h4>&lt;h5 id="分区">分区
&lt;/h5>&lt;p>  &lt;strong>建议先对爱快分区内的文件备份，因为需要单独给Alpine配置一个分区。&lt;/strong>
&lt;img src="https://images.337845818.best/20250909/24e29e18086aec5ed47a7b556c3d1d00.webp" alt="image" />
  因为硬盘只有32G，我打算分成三块，4G给系统日志绰绰有余，12G分配做普通存储，用自带的Docker还有存放一些文件的时候使用，剩下的全部都留作Alpine的分区。注意的是Alpine的分区不需要绑定业务，也无需挂载，格式化好之后放着就行。&lt;/p>
&lt;h5 id="上传镜像">上传镜像
&lt;/h5>&lt;p>  刚才我们分配做普通存储的分区下新建一个文件夹ISO，然后到https://www.alpinelinux.org/downloads/找到Virtual下的x86_64（如果是arm系统就下载arm/aarch），下载针对虚拟机的最新版本ISO，目前最新的是：https://dl-cdn.alpinelinux.org/alpine/v3.22/releases/x86_64/alpine-virt-3.22.1-x86_64.iso存放到ISO文件夹，或者不限难看直接放在根目录也行。
&lt;img src="https://images.337845818.best/20250909/b02c4936ba10bc89580509147ced1b26.png" alt="image" />&lt;br>
&lt;img src="https://images.337845818.best/20250909/55c9379571902c138c6999b5f74770c1.webp" alt="image" />
  找到文件后点击查看路径并复制路径备用。&lt;/p>
&lt;h4 id="新增虚拟机">新增虚拟机
&lt;/h4>&lt;h5 id="配置虚拟机">配置虚拟机
&lt;/h5>&lt;p>  在高级应用-虚拟机下选择添加。
&lt;img src="https://images.337845818.best/20250909/de7110d9c3da17a3fc3926ded449caa2.png" alt="image" />
  配置方面根据自己的实际情况添加即可，虚拟机名称任意天蝎，系统类型选Linux，CPU使用率我只给80%，核心数给2，内存分配1024M。
&lt;img src="https://images.337845818.best/20250909/9bf9b8e560fc1bff3574ddb9ec5d5c61.png" alt="image" />
  设备管理需要手工添加一个分区，设备类型为磁盘，磁盘类型选引用分区，勾选半虚拟化，分区名称选择前面我们分区时没格式化的那个，我这里显示的是sda7。
&lt;img src="https://images.337845818.best/20250909/dbe4e032b6f92242beb2ab24ac18c362.png" alt="image" />
  下面虚拟机光驱就填写前面我们的ISO文件路径，VNC外部访问一定要打开，密码和端口任意，下面的开机自启、UEFI启动和硬件加速也打开，然后保存。
&lt;img src="https://images.337845818.best/20250909/ee42a0298af19eac928e89e946144893.webp" alt="webp-virtual-2" />&lt;/p>
&lt;h5 id="安装alpine">安装Alpine
&lt;/h5>&lt;p>  启动虚拟机，返回上一层的操作部分点击VNC，输入之前配置的密码，进入到系统安装界面。
&lt;img src="https://images.337845818.best/20250909/1ae4dc97b71036f4fa51d9d00683e534.png" alt="8f0b0496-59b7-469f-843f-730d4fa95a16" />
  默认的用户名是&lt;code>root&lt;/code>，没有密码直接回车。
  然后按提示进行配置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">localhost:~# setup-alpine &lt;span class="c1">#执行安装脚本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Select keyboard layout:&lt;span class="o">[&lt;/span>none&lt;span class="o">]&lt;/span> us &lt;span class="c1">#选择键盘布局，选us即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Select variant &lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;abort&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span>: us-intl &lt;span class="c1">#选择布局变种，我是随便选的&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter system hostname &lt;span class="o">(&lt;/span>fully qualified from, e.g. &lt;span class="s1">&amp;#39;foo.example.org&amp;#39;&lt;/span>&lt;span class="o">)[&lt;/span>localhost&lt;span class="o">]&lt;/span> &lt;span class="c1">#系统名，一般直接保持localhost&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Which one &lt;span class="k">do&lt;/span> you want to initialize? &lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;?&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;done&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>eth0&lt;span class="o">]&lt;/span> &lt;span class="c1">#选择网卡，一般默认eth0即可，如果有另外添加网卡或其他特殊情况再调整&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ip address &lt;span class="k">for&lt;/span> eth0?&lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;dhcp&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;?&amp;#39;&lt;/span>&lt;span class="o">)[&lt;/span>dhcp&lt;span class="o">]&lt;/span>192.168.233.233 &lt;span class="c1">#获取eth0网卡IP的方式，默认dhcp，但是我爱快没开dhcp，配置的静态路由，所以我填写爱快网段内任意一个没占用的IP。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Do you want to &lt;span class="k">do&lt;/span> any manual network configuration?&lt;span class="o">(&lt;/span>y/n&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>n&lt;span class="o">]&lt;/span> &lt;span class="c1">#是否需要手动设置网络，y则进入vi界面编辑网络配置文件，如无需要直接n&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New Password: &lt;span class="c1">#设置root用户的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Retype password: &lt;span class="c1">#再输入一次&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Which timezone are you in? &lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;?&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>UTC&lt;span class="o">]&lt;/span> Asia &lt;span class="c1">#选择时区&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">What sub-timezone of &lt;span class="s1">&amp;#39;Asia&amp;#39;&lt;/span> are you in? &lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;?&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> Shanghai &lt;span class="c1">#选择子时区&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HTTP/FTP proxy URL? &lt;span class="o">(&lt;/span>e.g. &lt;span class="s1">&amp;#39;http://proxy:8080&amp;#39;&lt;/span>, or &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>none&lt;span class="o">]&lt;/span> &lt;span class="c1">#是否需要代理访问网络&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Which NTP client to run? &lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;busybox&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;openntpd&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;chrony&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>busybox&lt;span class="o">]&lt;/span> &lt;span class="c1">#用哪个作为ntp终端，默认即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter mirror number or URL: &lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span> f &lt;span class="c1">#选择软件源，最好选择第一项，即f，会遍历所有镜像留下最快的那个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Setup a user? &lt;span class="o">(&lt;/span>enter a lower-case loginname, or &lt;span class="s1">&amp;#39;no&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>no&lt;span class="o">]&lt;/span> alpine &lt;span class="c1">#是否新建各一般用户，是则输入用户名，否则no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Full name &lt;span class="k">for&lt;/span> user alpine &lt;span class="o">[&lt;/span>alpine&lt;span class="o">]&lt;/span> &lt;span class="c1">#新用户的全名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New Password: &lt;span class="c1">#设置root用户的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Retype password: &lt;span class="c1">#再输入一次&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter ssh key or URL &lt;span class="k">for&lt;/span> alpine &lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>none&lt;span class="o">]&lt;/span> &lt;span class="c1">#输入新用户的ssh key，直接回车给它自己处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Which ssh server?&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;openssh&amp;#39;&lt;/span>, &lt;span class="s1">&amp;#39;dropbear&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>openssh&lt;span class="o">]&lt;/span> &lt;span class="c1">#选择默认的ssh服务，一般都是用openssh，直接回车&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Which disk&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> you like to use &lt;span class="o">(&lt;/span>or &lt;span class="s1">&amp;#39;?&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nb">help&lt;/span> or &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>none&lt;span class="o">]&lt;/span> vda2 &lt;span class="c1">#要安装在哪个硬盘。如果前面没有手工把sda7分区添加进来这里则是空的，我这边系统中显示这个分区是vda2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">How would you like to use it? &lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;sys&amp;#39;&amp;#39;, &amp;#39;&lt;/span>data&lt;span class="s1">&amp;#39;, &amp;#39;&lt;/span>lvm&lt;span class="s1">&amp;#39; or &amp;#39;&lt;/span>?&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="nb">help&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>?&lt;span class="o">]&lt;/span> sys &lt;span class="c1">#要怎么使用这个硬盘，一般选sys即可，所有文件都放在这个分区上，如果挂了多个分区可以分别配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Erase the above disk&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> and &lt;span class="k">continue&lt;/span>? &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>: y &lt;span class="c1">#是否要格式化硬盘&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installation is complete. Please reboot. reboot &lt;span class="c1">#是否重启&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="配置必要环境和docker">配置必要环境和Docker
&lt;/h5>&lt;p>  重启后可以直接用ssh连接alpine了，不需要再使用VNC。首先把软件包升级，Aplnes的安装器是apk，有点抽象。
  先执行&lt;code>su -&lt;/code>和&lt;code>apk update&lt;/code>拉取索引，然后用&lt;code>apk add sudo&lt;/code>安装sudo包，如果提示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">localhost:~# apk add sudo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ERROR: unable to &lt;span class="k">select&lt;/span> packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo &lt;span class="o">(&lt;/span>no such package&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> required by: world&lt;span class="o">[&lt;/span>sudo&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>  可能是dns的问题，需要手动调整dns：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">localhost:~# vi /etc/resolv.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nameserver 223.5.5.5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>  然后再重新安装sudo:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">localhost:~# apk add sudo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost:~# vi /etc/sudoers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root &lt;span class="nv">ALL&lt;/span>&lt;span class="o">=(&lt;/span>ALL:ALL&lt;span class="o">)&lt;/span> ALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alpine &lt;span class="nv">ALL&lt;/span>&lt;span class="o">=(&lt;/span>ALL:ALL&lt;span class="o">)&lt;/span> ALL &lt;span class="c1">#添加这行到上面那行下面，alpine换成实际用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>  接下来安装Docker：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">localhost:~# apk add docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost:~# rc-update add docker boot &lt;span class="c1">#添加docker到开机自启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost:~# service docker start &lt;span class="c1">#启动docker服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost:~# docker -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Docker version 28.3.3, build 980b85681696fbd95927fd8ded8f6d91bdca95b0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>  还可以给自己新增的一般用户增加docker权限：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">localhost:~# apk add shadow &lt;span class="c1">#因为alpine默认没有usermod，需要手动安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost:~# usermod -aG docker alpine &lt;span class="c1">#alpine换成实际用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">localhost:~# newgrp docker &lt;span class="c1">#重新登录用户，也可以直接注销会话再登录&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>[好软推荐] Cloudpaste-开源在线文本/文件分享平台</title><link>https://blog.tama.guru/record/cloudpaste.html</link><pubDate>Fri, 18 Jul 2025 10:21:11 +0800</pubDate><guid>https://blog.tama.guru/record/cloudpaste.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post [好软推荐] Cloudpaste-开源在线文本/文件分享平台" />&lt;p>之前看到有人推荐了&lt;a class="link" href="https://github.com/ling-drag0n/CloudPaste" target="_blank" rel="noopener"
>cloudpaste&lt;/a>这个项目，主要作用是能够提供简单的文本及文件分享服务，前后端部分使用GitHub Action+Cloudflare Worker，存储桶部分使用Cloudflare R2等免费服务，即可实现免费使用。除了在国内因为众所周知的原因Worker域名无法访问，需要自行配置域名。&lt;/p>
&lt;p>前后端配置基本可以直接参照项目内文档：&lt;/p>
&lt;h5 id="github-仓库fork和后端配置">GitHub 仓库fork和后端配置
&lt;/h5>&lt;p>受限要将仓库fork下来，然后为fork的仓库添加变量，具体路径为仓库的&lt;code>Settings-Secrets and variables-Actions-New repository secrets&lt;/code>。添加的secrets为：&lt;/p>
&lt;ul>
&lt;li>CLOUDFLARE_API_TOKEN&lt;/li>
&lt;li>CLOUDFLARE_ACCOUNT_ID&lt;/li>
&lt;li>ENCRYPTION_SECRET&lt;/li>
&lt;/ul>
&lt;p>前面两个参数在后面获取到，后面的ENCRYPTION_SECRET可以选填，如果没有会自动生成。&lt;/p>
&lt;h5 id="cloudflare-token配置">CloudFlare TOKEN配置
&lt;/h5>&lt;p>登录CloudFlare后访问&lt;a class="link" href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" rel="noopener"
>API令牌管理&lt;/a>界面，创建一个新的API令牌，模版选择&amp;quot;Cloudflare Workers&amp;quot;，并编辑内容添加D1数据库编辑权限，记录下TOKEN，即为后面要用到的&lt;code>CLOUDFLARE_API_TOKEN&lt;/code>。
&lt;code>CLOUDFLARE_ACCOUNT_ID&lt;/code>位于Cloudflare主界面的右侧。&lt;/p>
&lt;h5 id="开通d1和r2并配置pages">开通D1和R2，并配置Pages
&lt;/h5>&lt;p>D1位于左侧的存储和数据库下，的D1 SQL数据库；R2位于左侧的R2对象存储。两者都是需要点进去开通即可，其他不需要动。
D1和R2都有免费额度，可以大胆使用。&lt;/p>
&lt;h5 id="github-配置actions前端自动部署">GitHub 配置Actions前端自动部署
&lt;/h5>&lt;p>返回到GitHub仓库页，找到Actions，运行&lt;code>deploy-front-cloudflare.yml&lt;/code>这个工作流，初次运行会进行D1数据库和Pages的创建。&lt;/p>
&lt;h5 id="配置cloudflare-workers">配置CloudFlare Workers
&lt;/h5>&lt;p>Pages现在已经移动到&lt;code>计算（Workers）&lt;/code>下，找到&lt;code>Workers和Pages&lt;/code>，此时应该会看到刚才工作流创建的Pages，我的前端名称是&lt;code>cloudpaste-frontend&lt;/code>，后端为&lt;code>cloudpaste-backend&lt;/code>。
先配置&lt;code>cloudpaste-backend&lt;/code>，在项目内的&lt;code>设置-变量和机密&lt;/code>，添加一个文本类型的变量，变量名是&lt;code>ENCRYPTION_SECRET&lt;/code>，值即之前我们自己填的或者自动生成的。然后要配置&lt;code>域和路由&lt;/code>，添加一个自定义域，这里最好设置一个自己的域名（例如https://backend.tama.guru），因为默认分配的workers.dev这个域名无法直接访问，使用部分功能时会受限。
然后到配置&lt;code>cloudpaste-frontend&lt;/code>这边，也是进到&lt;code>设置&lt;/code>，找到&lt;code>变量和机密&lt;/code>，添加一个文本类型的变量，变量名是&lt;code>VITE_BACKEND_URL&lt;/code>，对应的值是刚才在&lt;code>cloudpaste-backend&lt;/code>中的&lt;code>workers.dev&lt;/code>域名或自定义的域名，注意填写末尾不带&amp;quot;/&amp;quot;。同样的，还需要在&lt;code>cloudpaste-frontend&lt;/code>的自定义域配置一个自己的域名（例如https://frontend.tama.guru），并配置好解析。&lt;/p>
&lt;h5 id="重新运行前端工作流">重新运行前端工作流
&lt;/h5>&lt;p>返回到GitHub仓库页，找到Actions，再次运行&lt;code>deploy-front-cloudflare.yml&lt;/code>这个工作流。运行完成之后之前的配置才回生效，此时可以通过https://frontend.tama.guru访问前端，而对应的后端则是https://backend.tama.guru。&lt;/p>
&lt;h5 id="完成初步配置工作">完成初步配置工作
&lt;/h5>&lt;p>访问前端地址登录后台，默认的管理员信息是：&lt;strong>用户名: admin, 密码: admin123&lt;/strong>，登录后请马上修改。&lt;/p>
&lt;h5 id="挂载s3存储">挂载S3存储
&lt;/h5>&lt;p>完成以上工作后仅能实现文本分享和编辑的功能，如果需要实现文件分享还需要配置S3存储，目前建议使用的包括R2、B2、七牛云三个，三个都有免费额度，且经过一段时间的试用相关功能都是正常的。&lt;/p>
&lt;h6 id="挂载r2存储桶">挂载R2存储桶
&lt;/h6>&lt;p>打开CloudFlare R2对象存储页面，新建一个存储桶，比如我命名为&lt;code>cloudpaste-r2&lt;/code>，并添加一个API令牌。令牌权限为读和写，制定存储桶为&lt;code>cloudpaste-r2&lt;/code>，其他不用动，保存并记录API令牌，然后点进&lt;code>cloudpaste-r2&lt;/code>存储桶，在设置下找到&lt;code>CORS策略&lt;/code>，点击编辑，内容为：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;AllowedOrigins&amp;#34;: [&amp;#34;http://localhost:3000&amp;#34;, &amp;#34;https://根据自己的前端域名来替代，比如我的https://frontend.tama.guru&amp;#34;],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;AllowedMethods&amp;#34;: [&amp;#34;GET&amp;#34;, &amp;#34;PUT&amp;#34;, &amp;#34;POST&amp;#34;, &amp;#34;DELETE&amp;#34;, &amp;#34;HEAD&amp;#34;],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;AllowedHeaders&amp;#34;: [&amp;#34;*&amp;#34;],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;ExposeHeaders&amp;#34;: [&amp;#34;ETag&amp;#34;],
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;MaxAgeSeconds&amp;#34;: 3600
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后回到前端页面的后台，在S3存储配置下添加一个新配置，&lt;code>配置名称&lt;/code>任意，为了区分我起名和r2存储桶一样的名字&lt;code>cloudpaste-r2&lt;/code>，&lt;code>提供商&lt;/code>为&lt;code>Cloudflare R2&lt;/code>，&lt;code>存储桶名称&lt;/code>即&lt;code>cloudpaste-r2&lt;/code>，&lt;code>存储容量&lt;/code>最好就保留10G，好像就免费10G？&lt;code>端点URL&lt;/code>按要求的格式填写&lt;code>https://&amp;lt;accountid&amp;gt;.r2.cloudflarestorage.com&lt;/code>，&lt;code>accountid&lt;/code>在cloudflare页面下可以找到，也就是前面所说的&lt;code>CLOUDFLARE_ACCOUNT_ID&lt;/code>。&lt;code>区域&lt;/code>根据建桶时所选的位置，我选的亚太，这里就填apac，默认填auto也可以。&lt;code>访问密钥 ID&lt;/code>和&lt;code>秘密访问密钥&lt;/code>即上面申请到的&lt;code>API令牌信息&lt;/code>，其他可以保持默认不变，保存即可。此时点击&lt;code>测试连接&lt;/code>，应该会提示：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">配置完全可用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">✓ 读权限正常 ✓ 写权限正常 ✓ CORS 配置正确 ✓ 前端上传模拟成功
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果没有配置CORS，这里会提示CORS配置不正确，上传文件时也会报错。&lt;/p>
&lt;p>最后到&lt;code>挂载管理&lt;/code>处，选择&lt;code>新建挂载点&lt;/code>，&lt;code>挂载点名称&lt;/code>也是任意的，为保持一致我使用&lt;code>cloudpaste-r2&lt;/code>，&lt;code>存储类型&lt;/code>为S3存储，&lt;code>S3存储配置&lt;/code>选择刚才创建的&lt;code>cloudpaste-r2(Cloudflare R2)&lt;/code>，&lt;code>挂载路径&lt;/code>我填写的是&lt;code>/r2&lt;/code>，根据个人情况填写即可，最后&lt;code>勾选启用状态&lt;/code>，选择创建即可。 此时在文件上传页面和挂载浏览页面都可以看到这个&lt;code>r2&lt;/code>挂载点了，可以尝试上传文件，如果提示大小超限需要到后台的&lt;code>系统设置&lt;/code>中调整&lt;code>最大上传文件大小&lt;/code>，并更新设置，该选项默认为100MB。&lt;/p>
&lt;h6 id="挂载七牛云对象存储kodo">挂载七牛云对象存储kodo
&lt;/h6>&lt;p>我以七牛云作为兼容S3标准的代表，在七牛云的对象存储中选择空间管理-新建空间，存储空间名称和R2中存储桶名称意义一致，我填写的是&lt;code>cloudpaste-qiniu&lt;/code>，存储区域选择国外任意地点（选择国内需要实名），我选择北美-洛杉矶，访问控制选择为私有。还需要配置CORS规则，点进&lt;code>cloudpaste-qiniu&lt;/code>这个桶的&lt;code>空间设置&lt;/code>，&lt;code>跨域设置&lt;/code>内&lt;code>新增规则&lt;/code>，&lt;code>来源&lt;/code>填写我们的&lt;code>前端域名https://frontend.tama.guru&lt;/code>，&lt;code>允许 Methods&lt;/code>我全勾选了，然后保存。
七牛云并没有针对存储桶有单独的API密钥，需要到&lt;code>个人中心&lt;/code>中的&lt;code>密钥管理&lt;/code>，打开&lt;code>密钥访问权限&lt;/code>，并新增一组AccessKey/SecretKey，保存好这组AK和SK。
回到网站后台，操作和前面一样，只不过提供商类型要选择其他S3兼容服务，端点URL为：&lt;code>http://存储空间名称.s3.存储区域名称.qiniucs.com&lt;/code>，根据上述配置我这里对应的是&lt;code>http://cloudpaste-qiniu.s3.us-north-1.qiniucs.com&lt;/code>，访问密钥即前面的AK，秘密访问密钥即SK，保存即可，其他参照R2的添加步骤即可。
需要注意的是，七牛云的免费套餐只支持http。&lt;/p></description></item><item><title>成功考取业余无线电B证</title><link>https://blog.tama.guru/record/ham-rank-b.html</link><pubDate>Wed, 02 Jul 2025 16:08:54 +0800</pubDate><guid>https://blog.tama.guru/record/ham-rank-b.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 成功考取业余无线电B证" />&lt;p>去年6月的时候看到市里有这个考试，当时也经常刷到网上经常有人晒无线电通联的相关消息，觉得超酷的，买了个欧迅UV9DP，并在考试后一个月成功拿到执照。小地方也不愧是小地方，在后来这段时间里我经常拿不是很合法的设备全频段扫描，基本上除了业务波段之外就都是杂音，还买了拉伸天线、八木天线，一年到头也没碰到过人（就算有也只有偷听铁路联控和FM广播的时候），后来调查了下市里是没有中继台的，周围又都是山，要么跑到山顶上，不然通讯范围基本被限制很死。还印了点QSL卡片，看这样子怕是这辈子都发不出去。&lt;br>&lt;/p>
&lt;p>正好过一年，闲得没事的时候刷到二季度考试开始报名，而且智谱APP下线了在线考试功能，有人推测是要换题库了，而且往后会更难，赶紧进行一个报名。&lt;br>&lt;/p>
&lt;p>B类的题目其实相当一部分在A类都见过，变化的地方主要是Q码简称变多了，并新增了一些物理学计算和电路判断的题目，我主要是靠前花几天时间用电脑刷题、看看大纲、总结规律，这次也顺利考过了。&lt;br>&lt;/p>
&lt;p>接下来可以考虑整点大功率设备搞点远距离通联，毕竟小小手台功率摆在那里，希望今年能在某个时候CQ到活人吧。&lt;/p></description></item><item><title>再见了 TypeCho</title><link>https://blog.tama.guru/new-record/typecho.html</link><pubDate>Tue, 01 Jul 2025 21:46:00 +0800</pubDate><guid>https://blog.tama.guru/new-record/typecho.html</guid><description>&lt;img src="https://images.337845818.best/20250806/6b0378c33ae92cb2cc02a8a7bce5a2fa.webp" alt="Featured image of post 再见了 TypeCho" />&lt;p>在经历过wordpress、zblog等一系列重型动态博客后，我切换到typecho并持续使用了很长一段时间。
typecho很好，它很轻量，超棒的插件和主题到处都是，我甚至入正了handsome主题。&lt;br>
但是，typecho更新实在太慢，属于是没有重大BUG几年不见更新一次那种，在我升级到php8.x之后经常冒出莫名其妙的错误，再加上驱动typecho需要nginx+php+mysql环境，对我的小鸡来说负担太重了，而且网站的访问量并不大，没必要占用这么大服务器资源，如果只是为了时不时写点东西，那还不如用静态博客好了。&lt;br>
hexo用过一段时间，现在的导航页就是基于hexo搭建的，这次尝试一下hugo。&lt;br>
总而言之，文章基本都迁移过来了，剩下的评论再看看怎么导入waline，就基本完成了迁移工作。&lt;br>
也许以后不会再见，还是谢谢你两年的陪伴。&lt;/p></description></item></channel></rss>